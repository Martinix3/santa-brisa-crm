(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1857],{24810:(e,a,t)=>{Promise.resolve().then(t.bind(t,77404))},26126:(e,a,t)=>{"use strict";t.d(a,{E:()=>i});var r=t(95155);t(12115);var s=t(74466),l=t(59434);let n=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:a,variant:t,...s}=e;return(0,r.jsx)("div",{className:(0,l.cn)(n({variant:t}),a),...s})}},38382:(e,a,t)=>{"use strict";t.d(a,{Fm:()=>p,Qs:()=>g,cj:()=>o,h:()=>x,qp:()=>h});var r=t(95155),s=t(12115),l=t(15452),n=t(74466),i=t(25318),d=t(59434);let o=l.bL;l.l9,l.bm;let c=l.ZL,m=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(l.hJ,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:a})});m.displayName=l.hJ.displayName;let u=(0,n.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),x=s.forwardRef((e,a)=>{let{side:t="right",className:s,children:n,...o}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(m,{}),(0,r.jsxs)(l.UC,{ref:a,className:(0,d.cn)(u({side:t}),s),...o,children:[n,(0,r.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,r.jsx)(i.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=l.UC.displayName;let p=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};p.displayName="SheetHeader";let h=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(l.hE,{ref:a,className:(0,d.cn)("text-lg font-semibold text-foreground",t),...s})});h.displayName=l.hE.displayName;let g=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(l.VY,{ref:a,className:(0,d.cn)("text-sm text-muted-foreground",t),...s})});g.displayName=l.VY.displayName},40413:(e,a,t)=>{"use strict";t.d(a,{P:()=>s});var r=t(34477);let s=(0,r.createServerReference)("7fce113003000975f3cda9fc515d7d6e3dd62e5158",r.callServer,void 0,r.findSourceMapURL,"deleteOrderFS")},54165:(e,a,t)=>{"use strict";t.d(a,{Cf:()=>u,Es:()=>p,HM:()=>c,L3:()=>h,c7:()=>x,lG:()=>d,rr:()=>g});var r=t(95155),s=t(12115),l=t(15452),n=t(25318),i=t(59434);let d=l.bL;l.l9;let o=l.ZL,c=l.bm,m=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(l.hJ,{ref:a,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s})});m.displayName=l.hJ.displayName;let u=s.forwardRef((e,a)=>{let{className:t,children:s,...d}=e;return(0,r.jsxs)(o,{children:[(0,r.jsx)(m,{}),(0,r.jsxs)(l.UC,{ref:a,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...d,children:[s,(0,r.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(n.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=l.UC.displayName;let x=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...t})};x.displayName="DialogHeader";let p=e=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};p.displayName="DialogFooter";let h=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(l.hE,{ref:a,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...s})});h.displayName=l.hE.displayName;let g=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(l.VY,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",t),...s})});g.displayName=l.VY.displayName},56822:(e,a,t)=>{"use strict";t.d(a,{t:()=>s});var r=t(34477);let s=(0,r.createServerReference)("7fb93df833adc85e063ceba3b3d183c2d5c225be68",r.callServer,void 0,r.findSourceMapURL,"updateOrderStatusFS")},61930:(e,a,t)=>{"use strict";t.d(a,{A:()=>l});var r=t(95155),s=t(12115);let l=e=>{let{value:a,options:t,locale:l="en-US",placeholder:n="N/D"}=e,[i,d]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{d(!0)},[]),"number"!=typeof a||isNaN(a))return(0,r.jsx)(r.Fragment,{children:n});if(!i){let e=2*(a%1!=0);return(0,r.jsx)(r.Fragment,{children:a.toFixed(e)})}return(0,r.jsx)(r.Fragment,{children:a.toLocaleString(l,t)})}},77404:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>ez});var r=t(95155),s=t(12115),l=t(44861),n=t(83343),i=t(80644),d=t(76322),o=t(34548),c=t(65119),m=t(19164),u=t(74641),x=t(52873),p=t(76959),h=t(73168),g=t(61055),f=t(58111),v=t(35079),b=t(57082),j=t(73672),y=t(10518),w=t(51920),N=t(50172),C=t(965),S=t(73158),A=t(34301),M=t(50594),I=t(18763),k=t(77223),E=t(75143),D=t(50402),R=t(78266),T=t(30285),P=t(66695),_=t(85511),F=t(59409),U=t(51055),z=t(87481),O=t(79557),L=t(56822),G=t(34477);let $=(0,G.createServerReference)("7fd9a72b383422291972e896a6447750b214512499",G.callServer,void 0,G.findSourceMapURL,"updateScheduledTaskFS"),V=(0,G.createServerReference)("7fe10a5490a93a7717da0af370c88ead3338781bca",G.callServer,void 0,G.findSourceMapURL,"addScheduledTaskFS");var B=t(40413);let H=(0,G.createServerReference)("7fa4faab3da4e4cd21d9019ede7e7bc941e3f9689a",G.callServer,void 0,G.findSourceMapURL,"reorderTasksBatchFS");var q=t(12372),J=t(54951),Z=t(53359),Y=t(1741);let W=(0,G.createServerReference)("7f9b9185765d6b16285cc7717d590c59296a875660",G.callServer,void 0,G.findSourceMapURL,"reorderEventsBatchFS");var Q=t(16021);let K=(0,G.createServerReference)("7f610cc9164fcb0e9d7ec41ec11a928a89e5d2fb54",G.callServer,void 0,G.findSourceMapURL,"getAllNotesFS"),X=(0,G.createServerReference)("7fd9223f5e166b5b648aa22a777ce85abd15ebe1f3",G.callServer,void 0,G.findSourceMapURL,"getNotesForUserFS");var ee=t(96656),ea=t(6874),et=t.n(ea),er=t(59434),es=t(38382),el=t(56104),en=t(35317),ei=t(71280),ed=t(90221),eo=t(62177),ec=t(68663),em=t(54165),eu=t(17759),ex=t(62523),ep=t(88539),eh=t(65331);let eg=e=>ec.Ik({clientSelectionMode:ec.k5(["existing","new"]).default("existing"),accountId:ec.Yj().optional(),newClientName:ec.Yj().optional(),notes:ec.Yj().min(3,"Las notas deben tener al menos 3 caracteres."),assignedToId:ec.Yj().optional(),visitDate:ec.p6()}).superRefine((a,t)=>{"Commercial"===e&&("existing"!==a.clientSelectionMode||a.accountId||t.addIssue({path:["accountId"],message:"Debes seleccionar una cuenta existente."}),"new"===a.clientSelectionMode&&(!a.newClientName||a.newClientName.trim().length<2)&&t.addIssue({path:["newClientName"],message:"El nombre del nuevo cliente es obligatorio."}))});function ef(e){let{isOpen:a,onOpenChange:t,onSave:l,selectedDate:i,taskCategory:d,taskToEdit:o}=e,{userRole:c,teamMember:m}=(0,U.A)(),[u,x]=s.useState(!1),[p,f]=s.useState([]),[v,b]=s.useState([]),[j,y]=s.useState(!0),w=!!o,C=w?"Editar Tarea: ".concat(o.clientName):"Commercial"===d?"A\xf1adir Nueva Tarea Comercial":"A\xf1adir Tarea Administrativa",S=w?"Modifica los detalles de la tarea programada.":"Commercial"===d?"Programando una nueva visita o tarea de seguimiento para el ".concat(i?(0,h.GP)(i,"dd 'de' MMMM 'de' yyyy",{locale:g.es}):"","."):"Programando una nueva tarea interna/administrativa para el ".concat(i?(0,h.GP)(i,"dd 'de' MMMM 'de' yyyy",{locale:g.es}):"","."),A=(0,eo.mN)({resolver:(0,ed.u)(eg(d)),defaultValues:{clientSelectionMode:"existing",accountId:void 0,newClientName:"",notes:"",assignedToId:void 0,visitDate:null!=i?i:new Date}});s.useEffect(()=>{!async function(){if(a){y(!0);try{let[e,a]=await Promise.all(["Commercial"===d?(0,eh.U)():Promise.resolve([]),"Admin"===c?(0,Q.I)(["SalesRep","Clavadista","Admin"]):Promise.resolve([])]);f(e),b(a)}catch(e){console.error("Failed to load data for new task dialog",e)}finally{y(!1)}}}()},[a,c,d]),s.useEffect(()=>{if(a)if(w&&o){let e=v.find(e=>e.name===o.salesRep);A.reset({visitDate:o.visitDate?(0,n.H)(o.visitDate):new Date,notes:o.notes||"",accountId:o.accountId||void 0,clientSelectionMode:"existing",newClientName:o.clientName||"",assignedToId:(null==e?void 0:e.id)||void 0})}else A.reset({visitDate:null!=i?i:new Date,clientSelectionMode:"existing",accountId:void 0,newClientName:"",notes:"",assignedToId:"Admin"===c?null==m?void 0:m.id:void 0})},[a,w,o,i,A,c,m,v]);let M=async e=>{x(!0),await l({...e,taskCategory:d},null==o?void 0:o.id),x(!1)},I=A.watch("clientSelectionMode");return(0,r.jsx)(em.lG,{open:a,onOpenChange:t,children:(0,r.jsxs)(em.Cf,{children:[(0,r.jsxs)(em.c7,{children:[(0,r.jsx)(em.L3,{children:C}),(0,r.jsx)(em.rr,{children:S})]}),j?(0,r.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,r.jsx)(N.A,{className:"h-8 w-8 animate-spin"})}):(0,r.jsx)(eu.lV,{...A,children:(0,r.jsxs)("form",{onSubmit:A.handleSubmit(M),className:"space-y-4",children:["Commercial"===d&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eu.zB,{control:A.control,name:"clientSelectionMode",render:e=>{let{field:a}=e;return(0,r.jsxs)(eu.eI,{children:[(0,r.jsx)(eu.lR,{children:"Cliente"}),(0,r.jsxs)(F.l6,{onValueChange:a.onChange,value:a.value,disabled:w,children:[(0,r.jsx)(eu.MJ,{children:(0,r.jsx)(F.bq,{children:(0,r.jsx)(F.yv,{})})}),(0,r.jsxs)(F.gC,{children:[(0,r.jsx)(F.eb,{value:"existing",children:"Cliente Existente"}),(0,r.jsx)(F.eb,{value:"new",children:"Cliente Nuevo"})]})]})]})}}),"existing"===I?(0,r.jsx)(eu.zB,{control:A.control,name:"accountId",render:e=>{var a;let{field:t}=e;return(0,r.jsxs)(eu.eI,{children:[(0,r.jsx)(eu.lR,{children:"Seleccionar Cuenta"}),(0,r.jsxs)(F.l6,{onValueChange:t.onChange,value:null!=(a=t.value)?a:"",children:[(0,r.jsx)(eu.MJ,{children:(0,r.jsx)(F.bq,{children:(0,r.jsx)(F.yv,{placeholder:"Busca y selecciona una cuenta..."})})}),(0,r.jsx)(F.gC,{children:p.map(e=>(0,r.jsx)(F.eb,{value:e.id,children:e.nombre},e.id))})]}),(0,r.jsx)(eu.C5,{})]})}}):(0,r.jsx)(eu.zB,{control:A.control,name:"newClientName",render:e=>{var a;let{field:t}=e;return(0,r.jsxs)(eu.eI,{children:[(0,r.jsx)(eu.lR,{children:"Nombre del Nuevo Cliente"}),(0,r.jsx)(eu.MJ,{children:(0,r.jsx)(ex.p,{placeholder:"Ej: Caf\xe9 del Puerto",...t,value:null!=(a=t.value)?a:""})}),(0,r.jsx)(eu.C5,{})]})}})]}),(0,r.jsx)(eu.zB,{control:A.control,name:"notes",render:e=>{var a;let{field:t}=e;return(0,r.jsxs)(eu.eI,{children:[(0,r.jsx)(eu.lR,{children:"Objetivo / Notas de la Tarea"}),(0,r.jsx)(eu.MJ,{children:(0,r.jsx)(ep.T,{placeholder:"Commercial"===d?"Ej: Presentar nuevo producto...":"Ej: Preparar informe trimestral...",...t,value:null!=(a=t.value)?a:""})}),(0,r.jsx)(eu.C5,{})]})}}),"Admin"===c&&(0,r.jsx)(eu.zB,{control:A.control,name:"assignedToId",render:e=>{var a;let{field:t}=e;return(0,r.jsxs)(eu.eI,{children:[(0,r.jsx)(eu.lR,{children:"Asignar A"}),(0,r.jsxs)(F.l6,{onValueChange:t.onChange,value:null!=(a=t.value)?a:"",children:[(0,r.jsx)(eu.MJ,{children:(0,r.jsx)(F.bq,{children:(0,r.jsx)(F.yv,{placeholder:"Seleccionar responsable..."})})}),(0,r.jsx)(F.gC,{children:v.map(e=>(0,r.jsx)(F.eb,{value:e.id,children:e.name},e.id))})]}),(0,r.jsx)(eu.C5,{})]})}}),(0,r.jsxs)(em.Es,{children:[(0,r.jsx)(em.HM,{asChild:!0,children:(0,r.jsx)(T.$,{type:"button",variant:"outline",children:"Cancelar"})}),(0,r.jsx)(T.$,{type:"submit",disabled:u,children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"})," Guardando..."]}):"Guardar Tarea"})]})]})})]})})}function ev(e){let{isOpen:a,onOpenChange:t,onSelectType:s,selectedDate:l}=e,n=e=>{s(e)};return(0,r.jsx)(em.lG,{open:a,onOpenChange:t,children:(0,r.jsxs)(em.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(em.c7,{children:[(0,r.jsx)(em.L3,{children:"\xbfQu\xe9 quieres a\xf1adir a tu agenda?"}),l&&(0,r.jsxs)(em.rr,{children:["Selecciona el tipo de entrada que quieres registrar para el ",(0,h.GP)(l,"dd 'de' MMMM",{locale:g.es}),"."]})]}),(0,r.jsxs)("div",{className:"py-4 grid grid-cols-1 gap-4",children:[(0,r.jsxs)(T.$,{variant:"outline",className:"h-20 text-lg flex items-center justify-start p-4 gap-4",onClick:()=>n("commercial_task"),children:[(0,r.jsx)(v.A,{className:"h-8 w-8 text-primary"}),(0,r.jsx)("span",{children:"Tarea Comercial"})]}),(0,r.jsxs)(T.$,{variant:"outline",className:"h-20 text-lg flex items-center justify-start p-4 gap-4",onClick:()=>n("event"),children:[(0,r.jsx)(f.A,{className:"h-8 w-8 text-purple-500"}),(0,r.jsx)("span",{children:"Evento"})]}),(0,r.jsxs)(T.$,{variant:"outline",className:"h-20 text-lg flex items-center justify-start p-4 gap-4",onClick:()=>n("admin_task"),children:[(0,r.jsx)(b.A,{className:"h-8 w-8 text-blue-500"}),(0,r.jsx)("span",{children:"Tarea Administrativa"})]})]})]})})}var eb=t(73221),ej=t(90010),ey=t(22346);let ew={commercial:"commercial",event:"event",admin:"admin"},eN={commercial:"bg-brand-yellow",event:"bg-brand-purple",admin:"bg-brand-blue"};function eC(e){let{date:a,activeModifiers:t}=e,s=[];return t&&Object.values(ew).forEach(e=>{t[e]&&s.push(eN[e])}),(0,r.jsxs)("div",{className:"relative flex h-full w-full items-center justify-center",children:[a.getDate(),s.length>0&&(0,r.jsx)("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 flex gap-[2px]",children:s.map((e,a)=>(0,r.jsx)("span",{className:(0,er.cn)("w-1.5 h-1.5 rounded-full",e)},a))})]})}var eS=t(47262),eA=t(66424),eM=t(94504),eI=t(18046),ek=t(91721);let eE=(0,G.createServerReference)("7f6d67f9b7e56d9796225748970506d6fefec59831",G.callServer,void 0,G.findSourceMapURL,"addNoteFS"),eD=(0,G.createServerReference)("7fdace1ea8cde7925b5f32401e445a23dc8fd5d99d",G.callServer,void 0,G.findSourceMapURL,"updateNoteStatusFS"),eR=(0,G.createServerReference)("7f8573b63bb421eaf12975ce9ec855a6303dab7ac1",G.callServer,void 0,G.findSourceMapURL,"deleteNoteFS");function eT(e){let{initialNotes:a,currentUserId:t,isAdmin:l,onNotesChange:n,allAssignableUsers:i,teamMembersMap:d}=e,[o,c]=s.useState(a),[m,u]=s.useState(""),[x,p]=s.useState(t),[h,g]=s.useState(!1),[f,v]=s.useState(null),{toast:b}=(0,z.dj)();s.useEffect(()=>{c(a)},[a]),s.useEffect(()=>{l||p(t)},[l,t]);let j=async e=>{if(e.preventDefault(),m.trim()){g(!0);try{await eE(m,t,x),u(""),l||p(t),n()}catch(e){b({title:"Error",description:"No se pudo a\xf1adir la nota.",variant:"destructive"})}finally{g(!1)}}},y=async(e,a)=>{v(e);try{await eD(e,a),n()}catch(e){b({title:"Error",description:"No se pudo actualizar la nota.",variant:"destructive"})}finally{v(null)}},w=async e=>{v(e);try{await eR(e),n()}catch(e){b({title:"Error",description:"No se pudo eliminar la nota.",variant:"destructive"})}finally{v(null)}},C=e=>{var a;return(null==(a=d.get(e))?void 0:a.name)||"Desconocido"};return(0,r.jsxs)(P.Zp,{className:"shadow-subtle hover:shadow-md transition-shadow duration-300",children:[(0,r.jsxs)(P.aR,{children:[(0,r.jsxs)(P.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(eM.A,{className:"h-5 w-5 text-primary"}),"Bloc de Notas R\xe1pido"]}),(0,r.jsx)(P.BT,{children:l?"A\xf1ade y gestiona todas las tareas r\xe1pidas del equipo.":"A\xf1ade y gestiona tus tareas r\xe1pidas personales."})]}),(0,r.jsxs)(P.Wu,{children:[(0,r.jsxs)("form",{onSubmit:j,className:"space-y-2 mb-4",children:[(0,r.jsx)(ex.p,{placeholder:"A\xf1adir una nueva tarea o idea...",value:m,onChange:e=>u(e.target.value),disabled:h}),(0,r.jsxs)("div",{className:"flex gap-2 justify-between",children:[l&&(0,r.jsxs)(F.l6,{value:x,onValueChange:p,children:[(0,r.jsx)(F.bq,{className:"w-[200px]",children:(0,r.jsx)(F.yv,{placeholder:"Asignar a..."})}),(0,r.jsx)(F.gC,{children:i.map(e=>(0,r.jsx)(F.eb,{value:e.id,children:e.name},e.id))})]}),(0,r.jsx)(T.$,{type:"submit",disabled:h||!m.trim(),className:l?"":"w-full",children:h?(0,r.jsx)(N.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eI.A,{className:"mr-2 h-4 w-4"})," A\xf1adir Nota"]})})]})]}),(0,r.jsx)(eA.F,{className:"h-48 pr-3",children:(0,r.jsxs)("div",{className:"space-y-2",children:[o.map(e=>(0,r.jsxs)("div",{className:"flex items-start gap-3 p-2 rounded-md transition-colors hover:bg-muted/50",children:[(0,r.jsx)(eS.S,{id:"note-".concat(e.id),checked:e.isCompleted,onCheckedChange:a=>y(e.id,!!a),disabled:f===e.id,className:"mt-1"}),(0,r.jsxs)("div",{className:"flex-grow",children:[(0,r.jsx)("label",{htmlFor:"note-".concat(e.id),className:(0,er.cn)("text-sm cursor-pointer",e.isCompleted&&"line-through text-muted-foreground"),children:e.content}),l&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,r.jsx)(ek.A,{className:"h-3 w-3"})," Asignada a: ",C(e.assignedToId)]})]}),f===e.id?(0,r.jsx)(N.A,{className:"h-4 w-4 animate-spin text-muted-foreground"}):(0,r.jsx)(T.$,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive flex-shrink-0",onClick:()=>w(e.id),"aria-label":"Eliminar nota",children:(0,r.jsx)(k.A,{className:"h-4 w-4"})})]},e.id)),0===o.length&&(0,r.jsx)("p",{className:"text-center text-sm text-muted-foreground pt-8",children:"No hay notas a\xfan. \xa1A\xf1ade una!"})]})})]})]})}let eP=e=>"evento"===e.type?(0,r.jsx)(f.A,{className:"h-5 w-5 text-brand-purple flex-shrink-0"}):"tarea_comercial"===e.type?(0,r.jsx)(v.A,{className:"h-5 w-5 text-brand-yellow flex-shrink-0"}):"tarea_administrativa"===e.type?(0,r.jsx)(b.A,{className:"h-5 w-5 text-brand-blue flex-shrink-0"}):(0,r.jsx)(v.A,{className:"h-5 w-5 text-brand-yellow flex-shrink-0"}),e_=e=>"Programada"===e.status&&"Commercial"===e.taskCategory?"Visita Programada":"Programada"===e.status&&"General"===e.taskCategory?"Tarea Administrativa":"Seguimiento"===e.status?"Seguimiento: ".concat(e.nextActionType||"N/D"):"Tarea Comercial";function eF(e){let{item:a,handleItemClick:t,onFollowUpClick:s,onCompleteClick:l}=e,{attributes:n,listeners:i,setNodeRef:d,transform:o,transition:c,isDragging:m}=(0,D.gl)({id:a.id}),u={transform:R.Ks.Transform.toString(o),transition:c,opacity:m?.5:1,zIndex:m?10:"auto"};return(0,r.jsx)("div",{ref:d,style:u,children:(0,r.jsx)(P.Zp,{className:"shadow-sm w-full hover:shadow-md transition-shadow group/item",children:(0,r.jsxs)(P.Wu,{className:"p-3 flex items-center justify-between gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 flex-grow min-w-0",children:[(0,r.jsx)("div",{...n,...i,className:"cursor-grab active:cursor-grabbing p-2 text-muted-foreground","aria-label":"Arrastrar para reordenar",children:eP(a)}),(0,r.jsxs)("div",{className:"flex-grow cursor-pointer",onClick:()=>t(a),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&t(a)},role:"button",tabIndex:0,children:[(0,r.jsx)("h4",{className:"font-semibold text-base truncate group-hover/item:text-primary",title:a.title,children:a.title}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground truncate",title:a.description,children:a.description})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-1.5 flex-shrink-0 w-32 text-right",children:[("tarea_comercial"===a.type||"tarea_administrativa"===a.type)&&(0,r.jsx)(ee.A,{type:"order",status:a.rawItem.status}),"evento"===a.type&&(0,r.jsx)(ee.A,{type:"event",status:a.rawItem.status}),"tarea_comercial"===a.type&&(0,r.jsxs)(T.$,{size:"sm",variant:"default",className:"w-full mt-1",onClick:e=>{e.stopPropagation(),s(a.rawItem)},children:[(0,r.jsx)(j.A,{className:"mr-2 h-3 w-3"}),"Registrar"]}),"tarea_administrativa"===a.type&&(0,r.jsxs)(T.$,{size:"sm",variant:"outline",className:"w-full mt-1",onClick:e=>{e.stopPropagation(),l(a)},children:[(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Completar"]})]})]})})})}function eU(e){let{item:a,dragOverlayProps:t}=e;if(!a)return null;let l=s.cloneElement(eP(a),{className:"h-5 w-5 text-primary-foreground"});return(0,r.jsx)("div",{...t,className:"flex items-center justify-center h-10 w-10 rounded-full bg-primary/80 shadow-xl",children:l})}function ez(){var e;let{userRole:a,teamMember:t,dataSignature:f,refreshDataSignature:v}=(0,U.A)(),{toast:b}=(0,z.dj)(),[R,G]=s.useState(!0),[ee,ea]=s.useState([]),[ed,eo]=s.useState([]),[ec,em]=s.useState(null),[eu,ex]=s.useState([]),[ep,eh]=s.useState([]),[eg,ew]=s.useState(new Date),[eN,eS]=s.useState("all"),[eA,eM]=s.useState("all"),[eI,ek]=s.useState("week"),[eE,eD]=s.useState(!1),[eR,ez]=s.useState(null),[eO,eL]=s.useState(!1),[eG,e$]=s.useState(null),[eV,eB]=s.useState(),[eH,eq]=s.useState("Commercial"),[eJ,eZ]=s.useState(!1),[eY,eW]=s.useState(!1),[eQ,eK]=s.useState(null),[eX,e0]=s.useState(null),[e5,e1]=s.useState(null),[e4,e2]=s.useState("card"),e8=(0,E.FR)((0,E.MS)(E.AN,{activationConstraint:{distance:8}}),(0,E.MS)(E.uN,{coordinateGetter:D.JR})),e3="Admin"===a;s.useEffect(()=>{!async function(){G(!0);try{let[e,r,s,i]=await Promise.all([(0,O.r)(),(0,q.r)(),(0,Q.I)(["SalesRep","Clavadista","Admin"]),"Admin"===a?K():t?X(t.id):Promise.resolve([])]),d=e.filter(e=>("Programada"===e.status||"Seguimiento"===e.status)&&("Programada"===e.status?e.visitDate:e.nextActionDate)&&(0,l.f)((0,n.H)("Programada"===e.status?e.visitDate:e.nextActionDate))).map(e=>{var a;return{id:e.id,date:(0,n.H)("Programada"===e.status?e.visitDate:e.nextActionDate),type:"General"===e.taskCategory?"tarea_administrativa":"tarea_comercial",title:e.clientName,description:e_(e),rawItem:e,orderIndex:null!=(a=e.orderIndex)?a:0}}),o=r.filter(e=>e.startDate&&(0,l.f)((0,n.H)(e.startDate))).map(e=>{var a;return{id:e.id,date:(0,n.H)(e.startDate),type:"evento",title:e.name,description:e.type,rawItem:e,orderIndex:null!=(a=e.orderIndex)?a:0}});ea([...d,...o].map(e=>{var a;return{...e,orderIndex:null!=(a=e.orderIndex)?a:0}})),eo(s),ex(i),eh(s.filter(e=>"Admin"===e.role||"SalesRep"===e.role))}catch(e){console.error("Error loading agenda data:",e),b({title:"Error al Cargar Agenda",variant:"destructive"})}finally{G(!1)}}()},[f,b,a,t]);let e6=s.useMemo(()=>new Map(ed.map(e=>[e.id,e])),[ed]),e7=s.useMemo(()=>{let e,a=ee;return"all"!==eA&&(a=a.filter(e=>"tareas_comerciales"===eA?"tarea_comercial"===e.type:"tareas_administrativas"===eA?"tarea_administrativa"===e.type:"eventos"===eA&&"evento"===e.type)),e3?"all"!==eN?a.filter(e=>{if("tarea_comercial"===e.type||"tarea_administrativa"===e.type){let a=e.rawItem,t=ed.find(e=>e.name===a.salesRep);return(null==t?void 0:t.id)===eN||a.clavadistaId===eN}return"evento"===e.type&&e.rawItem.assignedTeamMemberIds.includes(eN)}):a:t?a.filter(e=>{if("tarea_comercial"===e.type||"tarea_administrativa"===e.type){let a=e.rawItem;return a.salesRep===t.name||a.clavadistaId===t.id}return"evento"===e.type&&e.rawItem.assignedTeamMemberIds.includes(t.id)}):[]},[ee,eA,eN,e3,t,ed]),{commercialTaskDays:e9,eventDays:ae,adminTaskDays:aa}=s.useMemo(()=>{let e=new Set,a=new Set,t=new Set;return e7.forEach(r=>{let s=(0,i.o)(r.date);"tarea_comercial"===r.type?e.add(s.getTime()):"evento"===r.type?a.add(s.getTime()):"tarea_administrativa"===r.type&&t.add(s.getTime())}),{commercialTaskDays:Array.from(e).map(e=>new Date(e)),eventDays:Array.from(a).map(e=>new Date(e)),adminTaskDays:Array.from(t).map(e=>new Date(e))}},[e7]),{interval:at,itemsForView:ar}=s.useMemo(()=>{let e,a;"day"===eI?(e=(0,i.o)(eg),a=(0,d.D)(eg)):"week"===eI?(e=(0,o.k)(eg,{locale:g.es}),a=(0,c.$)(eg,{locale:g.es})):(e=(0,m.w)(eg),a=(0,u.p)(eg));let t=e7.filter(t=>(0,x.v)(t.date,{start:e,end:a})).sort((e,a)=>{var t,r;return(null!=(t=e.orderIndex)?t:0)-(null!=(r=a.orderIndex)?r:0)});return{interval:{start:e,end:a},itemsForView:t}},[eg,eI,e7]),as=s.useMemo(()=>e7.filter(e=>(0,p.r)(e.date,eg)).sort((e,a)=>{var t,r;return(null!=(t=e.orderIndex)?t:0)-(null!=(r=a.orderIndex)?r:0)}),[eg,e7]),al=s.useMemo(()=>"day"===eI?[]:Object.entries(ar.reduce((e,a)=>{let t=(0,h.GP)(a.date,"yyyy-MM-dd");return e[t]||(e[t]=[]),e[t].push(a),e},{})).sort((e,a)=>{let[t]=e,[r]=a;return new Date(t).getTime()-new Date(r).getTime()}),[ar,eI]),an=e=>{let a=new Date(eg);"day"===eI?a.setDate(a.getDate()+("next"===e?1:-1)):"week"===eI?a.setDate(a.getDate()+("next"===e?7:-1)):"month"===eI&&a.setMonth(a.getMonth()+("next"===e?1:-1)),ew(a)},ai=e=>{em(e)},ad=e=>{ez(e),eD(!0)},ao=async e=>{if("tarea_administrativa"===e.type)try{await (0,L.t)(e.id,"Completado"),b({title:"Tarea Completada",description:'"'.concat(e.title,'" ha sido marcada como completada.')}),v()}catch(e){b({title:"Error",description:"No se pudo marcar la tarea como completada: ".concat(e.message),variant:"destructive"})}},ac=async(e,a)=>{try{await (0,en.c4)(el.db,async r=>{let s=(0,en.H9)(el.db,"orders",a.id);r.update(s,{status:"Completado",lastUpdated:en.Dc.fromDate(new Date)});let l=(0,en.H9)((0,en.rJ)(el.db,"orders")),n=(e.numberOfUnits||0)*(e.unitPrice||0),i=a.salesRep;if(e.assignedSalesRepId&&i!==(null==t?void 0:t.name)){let a=ed.find(a=>a.id===e.assignedSalesRepId);a&&(i=a.name)}let d={clientName:a.clientName,accountId:a.accountId||null,createdAt:en.Dc.fromDate(new Date),lastUpdated:en.Dc.fromDate(new Date),salesRep:i,clavadistaId:a.clavadistaId||null,clientStatus:"existing",originatingTaskId:a.id,notes:e.notes||null,taskCategory:"Commercial",orderIndex:0};if("successful"===e.outcome)d.status="Confirmado",d.visitDate=en.Dc.fromDate(new Date),d.products=["Santa Brisa 750ml"],d.numberOfUnits=e.numberOfUnits,d.unitPrice=e.unitPrice,d.value=1.21*n,d.paymentMethod=e.paymentMethod;else if("follow-up"===e.outcome){if(d.status="Seguimiento",d.nextActionType=e.nextActionType,d.nextActionCustom="Opci\xf3n personalizada"===e.nextActionType?e.nextActionCustom:null,e.nextActionDate){let a=new Date(e.nextActionDate);a.setHours(12,0,0,0),d.nextActionDate=en.Dc.fromDate(a)}else d.nextActionDate=null;d.visitDate=null}else"failed"===e.outcome&&(d.status="Fallido",d.visitDate=en.Dc.fromDate(new Date),d.failureReasonType=e.failureReasonType,d.failureReasonCustom="Otro (especificar)"===e.failureReasonType?e.failureReasonCustom:null);r.set(l,d)}),b({title:"Interacci\xf3n Registrada",description:"Se ha guardado el resultado y actualizado la cartera."}),v()}catch(e){console.error("Transaction failed: ",e),b({title:"Error en la transacci\xf3n",description:"No se pudo guardar el resultado.",variant:"destructive"})}finally{eD(!1),ez(null)}},am=async(e,a)=>{if(!t)return void b({title:"Error",description:"No se pudo identificar al usuario.",variant:"destructive"});try{let r=new Date(e.visitDate);r.setHours(12,0,0,0);let s={...e,visitDate:r};a?(await $(a,s),b({title:"\xa1Tarea Actualizada!",description:"La tarea ha sido modificada en la agenda."})):(await V(s,t),b({title:"\xa1Tarea Creada!",description:"La nueva tarea ha sido a\xf1adida a la agenda."})),v(),eL(!1),e$(null)}catch(e){b({title:"Error al Guardar Tarea",description:e.message,variant:"destructive"})}},au=async(e,a)=>{if(e3)try{a?(await (0,J.T)(a,e),b({title:"\xa1Evento Actualizado!",description:'El evento "'.concat(e.name,'" ha sido actualizado.')})):(await (0,Z.Z)(e),b({title:"\xa1Evento A\xf1adido!",description:'El evento "'.concat(e.name,'" ha sido a\xf1adido.')})),v(),eW(!1),eK(null)}catch(e){console.error("Error saving event:",e),b({title:"Error al Guardar Evento",description:"No se pudo guardar el evento.",variant:"destructive"})}},ax=async()=>{if(eX)try{"evento"===eX.type?(await (0,Y.$)(eX.id),b({title:"Evento Eliminado",description:"El evento ha sido eliminado de la agenda."})):(await (0,B.P)(eX.id),b({title:"Tarea Eliminada",description:"La tarea ha sido eliminada de la agenda."})),v()}catch(e){b({title:"Error al Eliminar",description:"No se pudo eliminar el elemento.",variant:"destructive"})}finally{e0(null),em(null)}},ap=async e=>{e1(null);let{active:a,over:t}=e;if(!t||!a.id)return;let r=ee.find(e=>e.id===a.id);if(r){if("string"==typeof t.id&&t.id.startsWith("drop-")){if(a.id===t.id)return;let e=new Date(t.id.replace("drop-",""));if(e.setHours(12,0,0,0),!(0,l.f)(e)||(0,p.r)(r.date,e))return;let s=[...ee];ea(t=>t.map(t=>t.id===a.id?{...t,date:e,orderIndex:0}:t));try{let t=[{id:a.id,orderIndex:0,date:e}];"evento"===r.type?await W(t):await H(t),b({title:"Tarea Movida",description:'"'.concat(r.title,'" movida al ').concat((0,h.GP)(e,"dd/MM/yyyy"),".")}),v()}catch(e){console.error("Error moving task to new date:",e),b({title:"Error al Mover",description:"No se pudo actualizar la fecha.",variant:"destructive"}),ea(s)}}else if(a.id!==t.id){let e=ee.find(e=>e.id===t.id);if(e&&(0,p.r)(r.date,e.date)){let e=ee.filter(e=>(0,p.r)(e.date,r.date)),s=e.findIndex(e=>e.id===a.id),l=e.findIndex(e=>e.id===t.id);if(-1!==s&&-1!==l&&s!==l){let a=(0,D.be)(e,s,l);ea([...ee.filter(e=>!(0,p.r)(e.date,r.date)),...a.map((e,a)=>({...e,orderIndex:a}))].sort((e,a)=>{var t,r;return(null!=(t=e.orderIndex)?t:0)-(null!=(r=a.orderIndex)?r:0)}));try{let e=a.filter(e=>"evento"!==e.type).map((e,a)=>({id:e.id,orderIndex:a})),t=a.filter(e=>"evento"===e.type).map((e,a)=>({id:e.id,orderIndex:a}));await Promise.all([e.length>0?H(e):Promise.resolve(),t.length>0?W(t):Promise.resolve()]),b({title:"Agenda Reordenada",description:"El orden de las tareas del d\xeda se ha guardado."})}catch(e){console.error("Error reordering items:",e),b({title:"Error al Reordenar",description:"No se pudo guardar el nuevo orden.",variant:"destructive"}),ea(ee)}}}}}},ah=("Admin"===a||"SalesRep"===a)&&t;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(es.cj,{open:!!ec,onOpenChange:e=>!e&&em(null),children:[(0,r.jsxs)(E.Mp,{sensors:e8,collisionDetection:E.fp,onDragStart:e=>{let{active:a}=e,t=ee.find(e=>e.id===a.id);t&&(e1(t),e2("card"))},onDragOver:e=>{var a;let{over:t}=e,r=null==t||null==(a=t.id)?void 0:a.toString();(null==r?void 0:r.startsWith("drop-"))?"icon"!==e4&&e2("icon"):"card"!==e4&&e2("card")},onDragEnd:ap,children:[(0,r.jsxs)("div",{className:"flex flex-col h-full space-y-6",children:[(0,r.jsx)("header",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(w.A,{className:"h-8 w-8 text-primary"}),(0,r.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Agenda del Equipo"})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 flex-grow",children:[(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)(P.Zp,{className:"h-full flex flex-col",children:[(0,r.jsx)(P.aR,{children:(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,r.jsxs)(P.ZB,{className:"text-lg font-semibold",children:["Actividades para ","day"===eI?(0,h.GP)(eg,"dd MMMM, yyyy",{locale:g.es}):"".concat((0,h.GP)(at.start,"dd MMM",{locale:g.es})," - ").concat((0,h.GP)(at.end,"dd MMM, yyyy",{locale:g.es}))]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[e3&&(0,r.jsxs)(F.l6,{value:eN,onValueChange:eS,children:[(0,r.jsx)(F.bq,{className:"w-auto h-8 text-xs",children:(0,r.jsx)(F.yv,{placeholder:"Usuario..."})}),(0,r.jsxs)(F.gC,{children:[(0,r.jsx)(F.eb,{value:"all",children:"Todos"}),ed.map(e=>(0,r.jsx)(F.eb,{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)(F.l6,{value:eA,onValueChange:e=>eM(e),children:[(0,r.jsx)(F.bq,{className:"w-auto h-8 text-xs",children:(0,r.jsx)(F.yv,{placeholder:"Tipo..."})}),(0,r.jsxs)(F.gC,{children:[(0,r.jsx)(F.eb,{value:"all",children:"Todo"}),(0,r.jsx)(F.eb,{value:"tareas_comerciales",children:"T. Comerciales"}),(0,r.jsx)(F.eb,{value:"tareas_administrativas",children:"T. Admin."}),(0,r.jsx)(F.eb,{value:"eventos",children:"Eventos"})]})]})]})]})}),(0,r.jsx)(P.Wu,{className:"flex-grow overflow-y-auto pr-3",children:R?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)(N.A,{className:"h-8 w-8 animate-spin text-primary"})}):"day"===eI?(0,r.jsx)(D.gB,{items:as.map(e=>e.id),strategy:D._G,children:(0,r.jsx)("div",{className:"space-y-4",children:as.length>0?as.map(e=>(0,r.jsx)(eF,{item:e,handleItemClick:ai,onFollowUpClick:ad,onCompleteClick:ao},e.id)):(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground text-center",children:(0,r.jsx)("p",{children:"No hay actividades programadas con los filtros seleccionados."})})})}):al.length>0?(0,r.jsx)("div",{className:"space-y-6",children:al.map(e=>{let[a,t]=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:(0,h.GP)((0,n.H)(a),"EEEE dd 'de' MMMM",{locale:g.es})}),(0,r.jsx)(D.gB,{items:t.map(e=>e.id),strategy:D._G,children:(0,r.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,r.jsx)(eF,{item:e,handleItemClick:ai,onFollowUpClick:ad,onCompleteClick:ao},e.id))})})]},a)})}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground text-center",children:(0,r.jsx)("p",{children:"No hay actividades programadas con los filtros seleccionados para este periodo."})})})]})}),(0,r.jsxs)("div",{className:"lg:col-span-1 space-y-8",children:[(0,r.jsxs)(P.Zp,{children:[(0,r.jsxs)(P.aR,{className:"flex flex-row items-center justify-between gap-4 pb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 rounded-md bg-muted p-1",children:[(0,r.jsx)(T.$,{variant:"day"===eI?"primary":"ghost",className:"h-8 px-3",onClick:()=>ek("day"),children:"D\xeda"}),(0,r.jsx)(T.$,{variant:"week"===eI?"primary":"ghost",className:"h-8 px-3",onClick:()=>ek("week"),children:"Semana"}),(0,r.jsx)(T.$,{variant:"month"===eI?"primary":"ghost",className:"h-8 px-3",onClick:()=>ek("month"),children:"Mes"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(T.$,{variant:"outline",size:"icon",className:"h-9 w-9",onClick:()=>an("prev"),children:(0,r.jsx)(C.A,{className:"h-4 w-4"})}),(0,r.jsx)(T.$,{variant:"outline",size:"icon",className:"h-9 w-9",onClick:()=>an("next"),children:(0,r.jsx)(S.A,{className:"h-4 w-4"})})]}),(0,r.jsxs)(T.$,{onClick:()=>{eB(eg),eZ(!0)},size:"icon",className:"rounded-full h-8 w-8",children:[(0,r.jsx)(A.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"A\xf1adir Entrada"})]})]}),(0,r.jsx)(P.Wu,{className:"p-2 flex justify-center",children:(0,r.jsx)(_.V,{mode:"single",selected:eg,onSelect:e=>{e&&(ew(e),ek("day"))},locale:g.es,modifiers:{commercial:e9,event:ae,admin:aa},components:{DayContent:e=>{let{date:a}=e,{setNodeRef:t,isOver:s}=(0,E.zM)({id:"drop-".concat((0,h.GP)(a,"yyyy-MM-dd"))});return(0,r.jsx)("div",{ref:t,className:(0,er.cn)("h-full w-full transition-all duration-150 relative",s&&"scale-110 bg-primary/20 rounded-md z-10"),children:(0,r.jsx)(eC,{...e})})}},classNames:{today:"bg-muted/50",selected:"bg-primary text-primary-foreground hover:bg-primary/90 focus:bg-primary focus:text-primary-foreground"},className:"p-0"})}),(0,r.jsxs)(P.wL,{className:"flex-col items-start p-4 pt-0",children:[(0,r.jsx)(ey.w,{className:"mb-2"}),(0,r.jsx)("div",{className:"space-y-2 text-xs text-muted-foreground w-full",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full bg-brand-yellow"})," Tarea Comercial"]}),(0,r.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full bg-brand-purple"})," Evento"]}),(0,r.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full bg-brand-blue"})," Tarea Admin."]})]})})]})]}),ah&&(0,r.jsx)(eT,{initialNotes:eu,currentUserId:t.id,isAdmin:e3,onNotesChange:v,allAssignableUsers:ep,teamMembersMap:e6})]})]})]}),(0,r.jsx)(E.Hd,{dropAnimation:{duration:250,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},modifiers:"icon"===e4?[e=>{let{transform:a,activeNodeRect:t,draggingNodeRect:r}=e;return t&&r?{...a,x:a.x-r.width/2,y:a.y-r.height/2}:a}]:[],children:e5?"card"===e4?(0,r.jsx)(P.Zp,{className:"shadow-lg",children:(0,r.jsxs)(P.Wu,{className:"p-3 flex items-center gap-3",children:[eP(e5),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold",children:e5.title}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e5.description})]})]})}):(0,r.jsx)(eU,{item:e5}):null})]}),ec&&(0,r.jsxs)(es.h,{children:[(0,r.jsxs)(es.Fm,{children:[(0,r.jsxs)(es.qp,{className:"flex items-center gap-2",children:[eP(ec)," ",ec.title]}),(0,r.jsx)(es.Qs,{children:ec.description}),(0,r.jsx)("div",{className:"font-medium text-foreground mt-2",children:(0,h.GP)(ec.date,"EEEE, dd 'de' MMMM 'de' yyyy",{locale:g.es})})]}),(0,r.jsxs)("div",{className:"py-4 space-y-4",children:["tarea_comercial"===ec.type&&(0,r.jsxs)(T.$,{className:"w-full",onClick:()=>ad(ec.rawItem),children:[(0,r.jsx)(j.A,{className:"mr-2 h-4 w-4"}),"Registrar Resultado"]}),"tarea_administrativa"===ec.type&&(0,r.jsxs)(T.$,{className:"w-full",onClick:()=>ao(ec),children:[(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Marcar como Completada"]}),"evento"===ec.type&&(0,r.jsx)(T.$,{asChild:!0,className:"w-full",children:(0,r.jsxs)(et(),{href:"/events?viewEventId=".concat(ec.id),children:[(0,r.jsx)(M.A,{className:"mr-2 h-4 w-4"}),"Ver Detalles del Evento"]})}),("tarea_comercial"===ec.type||"tarea_administrativa"===ec.type)&&(0,r.jsxs)("div",{className:"text-sm space-y-2",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Responsable:"})," ",ec.rawItem.salesRep]}),ec.rawItem.clavadistaId&&(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Clavadista:"})," ",(null==(e=e6.get(ec.rawItem.clavadistaId))?void 0:e.name)||"N/D"]})]}),"evento"===ec.type&&(0,r.jsx)("div",{className:"text-sm space-y-2",children:(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Responsables:"})," ",ec.rawItem.assignedTeamMemberIds.map(e=>{var a;return null==(a=e6.get(e))?void 0:a.name}).filter(Boolean).join(", ")]})})]}),(e3||"SalesRep"===a&&ec.rawItem.salesRep===(null==t?void 0:t.name))&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ey.w,{}),(0,r.jsxs)("div",{className:"pt-4 flex justify-end gap-2",children:[(0,r.jsxs)(T.$,{variant:"outline",onClick:()=>{ec&&("evento"===ec.type?(eK(ec.rawItem),eW(!0)):(e$(ec.rawItem),eq(ec.rawItem.taskCategory),eL(!0)),em(null))},children:[(0,r.jsx)(I.A,{className:"mr-2 h-4 w-4"})," Editar"]}),(0,r.jsxs)(T.$,{variant:"destructive",onClick:()=>{ec&&e0(ec)},children:[(0,r.jsx)(k.A,{className:"mr-2 h-4 w-4"})," Eliminar"]})]})]})]})]}),(0,r.jsx)(ej.Lt,{open:!!eX,onOpenChange:e=>!e&&e0(null),children:(0,r.jsxs)(ej.EO,{children:[(0,r.jsxs)(ej.wd,{children:[(0,r.jsx)(ej.r7,{children:"\xbfEst\xe1s seguro?"}),(0,r.jsxs)(ej.$v,{children:["Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente la entrada: ",(0,r.jsxs)("strong",{className:"text-foreground",children:['"',null==eX?void 0:eX.title,'"']}),"."]})]}),(0,r.jsxs)(ej.ck,{children:[(0,r.jsx)(ej.Zr,{onClick:()=>e0(null),children:"Cancelar"}),(0,r.jsx)(ej.Rx,{onClick:ax,variant:"destructive",children:"S\xed, eliminar"})]})]})}),(0,r.jsx)(ei.A,{order:eR,isOpen:eE,onOpenChange:eD,onSave:ac,allTeamMembers:ed,currentUser:t,currentUserRole:a}),(0,r.jsx)(ef,{isOpen:eO,onOpenChange:e=>{eL(e),e||e$(null)},selectedDate:eV,onSave:am,taskCategory:eH,taskToEdit:eG}),(0,r.jsx)(ev,{isOpen:eJ,onOpenChange:eZ,onSelectType:e=>{eZ(!1),"commercial_task"===e?(eq("Commercial"),e$(null),eL(!0)):"admin_task"===e?(eq("General"),e$(null),eL(!0)):"event"===e&&(eK(null),eW(!0))},selectedDate:eV}),e3&&(0,r.jsx)(eb.A,{event:eQ,isOpen:eY,onOpenChange:e=>{eW(e),e||eK(null)},onSave:au,isReadOnly:!1,allTeamMembers:ed,allAccounts:[]})]})}},79557:(e,a,t)=>{"use strict";t.d(a,{r:()=>s});var r=t(34477);let s=(0,r.createServerReference)("7f889e4da298c8c8caa3b558dd449ec782a5648802",r.callServer,void 0,r.findSourceMapURL,"getOrdersFS")},96656:(e,a,t)=>{"use strict";t.d(a,{A:()=>i});var r=t(95155),s=t(26126),l=t(59434);let n={order:{Entregado:"bg-green-500 hover:bg-green-600 text-white",Completado:"bg-green-100 text-green-800 border border-green-300",Facturado:"bg-teal-500 hover:bg-teal-600 text-white",Confirmado:"bg-[hsl(var(--brand-turquoise-hsl))] hover:brightness-90 text-white",Enviado:"bg-purple-500 hover:bg-purple-600 text-white",Pendiente:"bg-yellow-400 hover:bg-yellow-500 text-black",Procesando:"bg-orange-400 hover:bg-orange-500 text-black",Programada:"bg-sky-500 hover:bg-sky-600 text-white",Cancelado:"bg-red-500 hover:bg-red-600 text-white",Fallido:"bg-red-500 hover:bg-red-600 text-white",Seguimiento:"bg-yellow-400 hover:bg-yellow-500 text-black"},account:{Repetición:"bg-emerald-500 hover:bg-emerald-600 text-white font-semibold",Activo:"bg-emerald-100 text-emerald-800 border border-emerald-200",Inactivo:"bg-orange-100 text-orange-800 border border-orange-200",Programada:"bg-amber-100 text-amber-800 border border-amber-200",Seguimiento:"bg-amber-100 text-amber-800 border border-amber-200",Fallido:"bg-rose-100 text-rose-800 border border-rose-200","Pendiente (Sin Interacci\xf3n)":"bg-gray-100 text-gray-800 border border-gray-200"},event:{Completado:"bg-green-500 hover:bg-green-600 text-white",Confirmado:"bg-blue-500 hover:bg-blue-600 text-white","En Curso":"bg-purple-500 hover:bg-purple-600 text-white",Planificado:"bg-yellow-400 hover:bg-yellow-500 text-black",Pospuesto:"bg-orange-400 hover:bg-orange-500 text-black",Cancelado:"bg-red-500 hover:bg-red-600 text-white"},document:{proforma:"bg-blue-100 text-blue-800 border border-blue-200",factura_pendiente:"bg-yellow-100 text-yellow-800 border border-yellow-200",factura_recibida:"bg-purple-100 text-purple-800 border border-purple-200",factura_validada:"bg-green-100 text-green-800 border border-green-200"},payment:{pagado:"bg-green-500 hover:bg-green-600 text-white",parcial:"bg-orange-400 hover:bg-orange-500 text-black",pendiente:"bg-red-500 hover:bg-red-600 text-white"},production:{Borrador:"bg-gray-400 hover:bg-gray-500 text-white",Programada:"bg-blue-400 hover:bg-blue-500 text-white","En curso":"bg-purple-500 hover:bg-purple-600 text-white",Pausada:"bg-orange-400 hover:bg-orange-500 text-black",Finalizada:"bg-green-500 hover:bg-green-600 text-white",Cancelada:"bg-red-500 hover:bg-red-600 text-white"},qc:{Released:"bg-green-100 text-green-800 border-green-300",Pending:"bg-yellow-100 text-yellow-800 border-yellow-300",Rejected:"bg-red-100 text-red-800 border-red-300"},tank:{Libre:"bg-green-100 text-green-800 border-green-300",Ocupado:"bg-gray-200 text-gray-800 border-gray-300",Limpieza:"bg-yellow-100 text-yellow-800 border-yellow-300"}};function i(e){var a;let{type:t,status:i,className:d}=e,o=(null==(a=n[t])?void 0:a[i])||"bg-gray-400 hover:bg-gray-500 text-white";return"account"===t&&e.isOverdue&&(o="bg-rose-600 hover:bg-rose-700 text-white"),(0,r.jsx)(s.E,{className:(0,l.cn)(o,"text-xs",d),children:i})}}},e=>{var a=a=>e(e.s=a);e.O(0,[2992,7138,5769,8884,1915,1490,587,7328,8965,1859,6874,6060,6764,6723,7655,1309,5866,6315,1549,6466,8347,8441,1684,7358],()=>a(24810)),_N_E=e.O()}]);