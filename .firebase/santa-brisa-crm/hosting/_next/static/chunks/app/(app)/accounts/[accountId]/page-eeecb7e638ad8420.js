(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1023],{8376:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(40157).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},12372:(e,a,s)=>{"use strict";s.d(a,{r:()=>i});var t=s(34477);let i=(0,t.createServerReference)("7f9691d0f9f547685d7820f71c8952cd5d14947e39",t.callServer,void 0,t.findSourceMapURL,"getEventsFS")},14701:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>G});var t=s(95155),i=s(12115),r=s(35695),c=s(30285),n=s(66695),l=s(85127),d=s(51055),o=s(50172),m=s(31949),u=s(12543),x=s(83173),h=s(18763),p=s(18018),j=s(91467),f=s(28294),N=s(19637),g=s(31554),y=s(83662),v=s(50594),A=s(94815),w=s(58111),b=s(73672),C=s(8376),k=s(97538),M=s(83343),P=s(44861),E=s(73168),S=s(61055),H=s(96656),T=s(61930),I=s(22346),D=s(87481),R=s(6874),F=s.n(R),z=s(49157),Z=s(65331),B=s(99058),L=s(79557),V=s(12372),q=s(16021),W=s(58051);let $=e=>{if(!e)return"No especificada";let a=[e.street?"".concat(e.street).concat(e.number?", ".concat(e.number):""):null,e.city,e.province,e.postalCode,(e.street||e.city||e.postalCode||e.province)&&(e.country||"Espa\xf1a")].filter(Boolean);return 0===a.length?"No especificada":a.join(",\n")},_=e=>{if("event"===e.itemType)return"Evento: ".concat(e.name);let{status:a,nextActionType:s,failureReasonType:t}=e;return"Programada"===a?"Visita Programada":"Seguimiento"===a?"Seguimiento (".concat(s||"N/D",")"):"Fallido"===a?"Visita Fallida (".concat(t||"N/D",")"):"Completado"===a?s||t?"Tarea Completada":"Interacci\xf3n Completada":"Pedido (".concat(a,")")};function G(){let e=(0,r.useParams)(),a=(0,r.useRouter)(),s=(0,r.useSearchParams)(),{userRole:R,teamMember:G,dataSignature:O,refreshDataSignature:U}=(0,d.A)(),{toast:Y}=(0,D.dj)(),[X,J]=i.useState(null),[K,Q]=i.useState(null),[ee,ea]=i.useState([]),[es,et]=i.useState([]),[ei,er]=i.useState(!0),[ec,en]=i.useState([]),[el,ed]=i.useState(!1),eo=e.accountId,em="Admin"===R||"SalesRep"===R;i.useEffect(()=>{!async function(){if(!eo){er(!1),J(null);return}er(!0);try{let[e,a,s,t,i]=await Promise.all([(0,z.p)(eo),(0,L.r)(),(0,V.r)(),(0,Z.U)(),(0,q.I)()]);if(J(e),et(i),e){let t=a.filter(a=>!!a.accountId&&a.accountId===e.id||!a.accountId&&!!a.cif&&!!e.cif&&a.cif.trim().toLowerCase()===e.cif.trim().toLowerCase()||!a.accountId&&!a.cif&&!!a.clientName&&!!e.nombre&&a.clientName.trim().toLowerCase()===e.nombre.trim().toLowerCase()),i=s.filter(a=>a.accountId===e.id),r=[...t.map(e=>({...e,itemType:"order"})),...i.map(e=>({...e,itemType:"event"}))];r.sort((e,a)=>{let s=(0,M.H)(e.createdAt||e.startDate);return(0,M.H)(a.createdAt||a.startDate).getTime()-s.getTime()}),en(r);let c=t.filter(e=>"Programada"===e.status||"Seguimiento"===e.status);c.sort((e,a)=>{let s="Programada"===e.status?e.visitDate:e.nextActionDate,t="Programada"===a.status?a.visitDate:a.nextActionDate;if(!s)return 1;if(!t)return -1;let i=(0,M.H)(s),r=(0,M.H)(t);return(0,P.f)(i)?(0,P.f)(r)?i.getTime()!==r.getTime()?i.getTime()-r.getTime():"Programada"===e.status&&"Programada"!==a.status?-1:+("Programada"===a.status&&"Programada"!==e.status):-1:1});let n=c[0];if(n)Q(n.status);else{let e=await (0,W.n)(t);Q(e)}}em&&ea(t)}catch(e){console.error("Error fetching account details or related data:",e),Y({title:"Error al Cargar Datos",description:"No se pudo cargar la informaci\xf3n de la cuenta o su historial.",variant:"destructive"}),J(null)}finally{er(!1)}}()},[eo,Y,em,O]),i.useEffect(()=>{em&&"true"===s.get("edit")&&X&&!ei&&ed(!0)},[s,X,em,ei]);let eu=async e=>{if(em&&X){er(!0);try{await (0,B.k)(X.id,e),U(),Y({title:"\xa1Cuenta Actualizada!",description:'La cuenta "'.concat(e.name,'" ha sido actualizada.')}),ed(!1),a.replace("/accounts/".concat(eo),void 0)}catch(e){console.error("Error updating account:",e),Y({title:"Error al Actualizar",description:"No se pudo actualizar la cuenta.",variant:"destructive"})}finally{er(!1)}}};if(ei)return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8",children:[(0,t.jsx)(o.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,t.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Cargando detalles de la cuenta..."})]});if(!X)return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8",children:[(0,t.jsx)(m.A,{className:"h-16 w-16 text-destructive mb-4"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"Cuenta no Encontrada"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"La cuenta que est\xe1s buscando no existe o ha sido eliminada."}),(0,t.jsxs)(c.$,{onClick:()=>a.push("/accounts"),children:[(0,t.jsx)(u.A,{className:"mr-2 h-4 w-4"})," Volver a Cuentas"]})]});let ex=X.salesRepId?es.find(e=>e.id===X.salesRepId):null,eh=X.embajadorId?es.find(e=>e.id===X.embajadorId):null,ep=X.createdAt&&(0,P.f)((0,M.H)(X.createdAt))?(0,E.GP)((0,M.H)(X.createdAt),"dd/MM/yyyy",{locale:S.es}):"N/D",ej=X.updatedAt&&(0,P.f)((0,M.H)(X.updatedAt))?(0,E.GP)((0,M.H)(X.updatedAt),"dd/MM/yyyy HH:mm",{locale:S.es}):"N/D",ef=e=>"order"===e.itemType&&["Programada","Seguimiento","Fallido"].includes(e.status);return(0,t.jsxs)("div",{className:"space-y-6",id:"printable-account-details",children:[(0,t.jsxs)("header",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 print-hide",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(c.$,{variant:"outline",size:"icon",onClick:()=>a.push("/accounts"),"aria-label":"Volver a la lista de cuentas",children:(0,t.jsx)(u.A,{className:"h-5 w-5"})}),(0,t.jsx)(x.A,{className:"h-8 w-8 text-primary"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:X.nombre}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:X.legalName||"Nombre fiscal no especificado"})]})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[em&&(0,t.jsxs)(c.$,{onClick:()=>{em&&X&&ed(!0)},disabled:ei,children:[(0,t.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Editar Cuenta"]}),(0,t.jsxs)(c.$,{variant:"outline",onClick:()=>{window.print()},children:[(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Imprimir Ficha"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"md:col-span-1 space-y-6",children:[(0,t.jsxs)(n.Zp,{className:"shadow-subtle",children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{className:"text-lg",children:"Informaci\xf3n General"})}),(0,t.jsxs)(n.Wu,{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"CIF/NIF:"})," ",(0,t.jsx)("strong",{className:"font-medium",children:X.cif||"No especificado"})]}),(0,t.jsx)(I.w,{}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Tipo:"})," ",(0,t.jsx)("strong",{className:"font-medium",children:X.type})]}),(0,t.jsx)(I.w,{}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Estado:"})," ",K?(0,t.jsx)(H.A,{type:"account",status:K}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"Calculando..."})]}),(0,t.jsx)(I.w,{}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Comercial:"})," ",(0,t.jsx)("strong",{className:"font-medium",children:ex?ex.name:"No asignado"})]}),eh&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.w,{}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Clavadista:"})," ",(0,t.jsxs)("strong",{className:"font-medium flex items-center gap-1",children:[(0,t.jsx)(j.A,{size:14}),eh.name]})]})]}),(0,t.jsx)(I.w,{}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Creada:"})," ",(0,t.jsx)("span",{className:"text-muted-foreground",children:ep})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Actualizada:"})," ",(0,t.jsx)("span",{className:"text-muted-foreground",children:ej})]})]})]}),(0,t.jsxs)(n.Zp,{className:"shadow-subtle",children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{className:"text-lg",children:"Contacto Principal"})}),(0,t.jsx)(n.Wu,{className:"space-y-2 text-sm",children:X.mainContactName||X.mainContactEmail||X.mainContactPhone?(0,t.jsxs)(t.Fragment,{children:[X.mainContactName&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(f.A,{size:16,className:"text-muted-foreground"})," ",(0,t.jsx)("span",{children:X.mainContactName})]}),X.mainContactEmail&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(N.A,{size:16,className:"text-muted-foreground"})," ",(0,t.jsx)("a",{href:"mailto:".concat(X.mainContactEmail),className:"text-primary hover:underline",children:X.mainContactEmail})]}),X.mainContactPhone&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(g.A,{size:16,className:"text-muted-foreground"})," ",(0,t.jsx)("span",{children:X.mainContactPhone})]})]}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"No hay informaci\xf3n de contacto principal."})})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,t.jsxs)(n.Zp,{className:"shadow-subtle",children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{className:"text-lg",children:"Direcciones"})}),(0,t.jsxs)(n.Wu,{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-medium mb-1 flex items-center",children:[(0,t.jsx)(y.A,{size:16,className:"mr-1.5 text-muted-foreground"}),"Direcci\xf3n Fiscal:"]}),(0,t.jsx)("p",{className:"text-muted-foreground whitespace-pre-line pl-6",children:$(X.addressBilling)})]}),(0,t.jsx)(I.w,{}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-medium mb-1 flex items-center",children:[(0,t.jsx)(y.A,{size:16,className:"mr-1.5 text-muted-foreground"}),"Direcci\xf3n de Entrega Principal:"]}),(0,t.jsx)("p",{className:"text-muted-foreground whitespace-pre-line pl-6",children:$(X.addressShipping)})]})]})]}),(0,t.jsxs)(n.Zp,{className:"shadow-subtle",children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{className:"text-lg",children:"Notas de la Cuenta"})}),(0,t.jsx)(n.Wu,{className:"text-sm",children:(0,t.jsx)("p",{className:"text-muted-foreground whitespace-pre-line",children:X.notes||"No hay notas para esta cuenta."})})]}),("Admin"===R||"SalesRep"===R)&&X.internalNotes&&(0,t.jsxs)(n.Zp,{className:"shadow-subtle bg-amber-50 border-amber-200 dark:bg-amber-950 dark:border-amber-800",children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsxs)(n.ZB,{className:"text-lg flex items-center",children:[(0,t.jsx)(v.A,{className:"mr-2 h-5 w-5 text-amber-600"}),"Notas Internas"]}),(0,t.jsx)(n.BT,{children:"Esta informaci\xf3n solo es visible para el equipo de ventas y administradores."})]}),(0,t.jsx)(n.Wu,{className:"text-sm",children:(0,t.jsx)("p",{className:"text-amber-800 dark:text-amber-200 whitespace-pre-line",children:X.internalNotes})})]})]})]}),(0,t.jsxs)(n.Zp,{className:"shadow-subtle print-section",children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{children:"Historial de Interacciones y Pedidos"}),(0,t.jsx)(n.BT,{children:"Registro de todas las visitas, seguimientos y pedidos asociados a esta cuenta."})]}),(0,t.jsx)(n.Wu,{children:ec.length>0?(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(l.XI,{children:[(0,t.jsx)(l.A0,{children:(0,t.jsxs)(l.Hj,{children:[(0,t.jsx)(l.nd,{className:"w-[5%]"}),(0,t.jsx)(l.nd,{className:"w-[15%]",children:"Fecha"}),(0,t.jsx)(l.nd,{className:"w-[20%]",children:"Tipo / Pr\xf3xima Acci\xf3n"}),(0,t.jsx)(l.nd,{className:"w-[10%] text-right",children:"Valor"}),(0,t.jsx)(l.nd,{className:"w-[15%] text-center",children:"Estado"}),(0,t.jsx)(l.nd,{className:"w-[15%]",children:"Comercial"}),(0,t.jsx)(l.nd,{className:"w-[15%]",children:"Notas / Objetivo Visita"}),(0,t.jsx)(l.nd,{className:"w-[10%] text-right print-hide",children:"Acciones"})]})}),(0,t.jsx)(l.BF,{children:ec.map(e=>{let a=_(e),s="Admin"===R||"order"===e.itemType&&("SalesRep"===R&&(null==G?void 0:G.name)===e.salesRep||"Clavadista"===R&&e.clavadistaId===(null==G?void 0:G.id)),i="order"===e.itemType?e:null,r="event"===e.itemType?e:null;return(0,t.jsxs)(l.Hj,{className:(null==i?void 0:i.status)==="Completado"?"bg-muted/40":"",children:[(0,t.jsx)(l.nA,{children:"order"===e.itemType?(0,t.jsx)(A.A,{className:"h-4 w-4 text-muted-foreground"}):(0,t.jsx)(w.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,t.jsx)(l.nA,{children:(0,E.GP)((0,M.H)((null==i?void 0:i.createdAt)||r.startDate),"dd/MM/yy HH:mm",{locale:S.es})}),(0,t.jsx)(l.nA,{children:a}),(0,t.jsx)(l.nA,{className:"text-right",children:(null==i?void 0:i.value)!==void 0?(0,t.jsx)(T.A,{value:i.value,locale:"es-ES",options:{style:"currency",currency:"EUR"}}):"—"}),(0,t.jsxs)(l.nA,{className:"text-center",children:["order"===e.itemType&&(0,t.jsx)(H.A,{type:"order",status:i.status}),"event"===e.itemType&&(0,t.jsx)(H.A,{type:"event",status:r.status})]}),(0,t.jsx)(l.nA,{children:(null==i?void 0:i.salesRep)||"N/A"}),(0,t.jsx)(l.nA,{className:"text-xs max-w-[200px] truncate",title:e.notes,children:e.notes||"N/D"}),(0,t.jsx)(l.nA,{className:"text-right print-hide",children:ef(e)&&s?(0,t.jsx)(c.$,{asChild:!0,variant:"outline",size:"sm",children:(0,t.jsxs)(F(),{href:"/order-form?originatingTaskId=".concat(e.id),children:[(0,t.jsx)(b.A,{className:"mr-1 h-3 w-3"})," Registrar Resultado"]})}):(0,t.jsxs)(c.$,{variant:"ghost",size:"sm",disabled:!0,children:[(0,t.jsx)(C.A,{className:"mr-1 h-3 w-3 text-green-500"})," Gestionado"]})})]},e.id)})})]})}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No hay interacciones ni pedidos registrados para esta cuenta."})})]}),em&&X&&(0,t.jsx)(k.A,{account:X,isOpen:el,onOpenChange:e=>{ed(e),e||a.replace("/accounts/".concat(eo),void 0)},onSave:eu,allAccounts:ee})]})}},24386:(e,a,s)=>{"use strict";s.d(a,{c:()=>r});var t=s(39140),i=s(35476);function r(e,a){let s=(0,i.a)(e),r=(0,i.a)(a),n=c(s,r),l=Math.abs((0,t.m)(s,r));s.setDate(s.getDate()-n*l);let d=Number(c(s,r)===-n),o=n*(l-d);return 0===o?0:o}function c(e,a){let s=e.getFullYear()-a.getFullYear()||e.getMonth()-a.getMonth()||e.getDate()-a.getDate()||e.getHours()-a.getHours()||e.getMinutes()-a.getMinutes()||e.getSeconds()-a.getSeconds()||e.getMilliseconds()-a.getMilliseconds();return s<0?-1:s>0?1:s}},28294:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(40157).A)("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]])},50594:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(40157).A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},58051:(e,a,s)=>{"use strict";s.d(a,{n:()=>n});var t=s(44861),i=s(83343),r=s(24386),c=s(91950);async function n(e){let a=e.filter(e=>c.s.includes(e.status)&&e.createdAt&&(0,t.f)((0,i.H)(e.createdAt))).sort((e,a)=>(0,i.H)(a.createdAt).getTime()-(0,i.H)(e.createdAt).getTime()),s=a.length;if(0===s)return"Fallido";let n=(0,i.H)(a[0].createdAt);return(0,r.c)(new Date,n)>30?"Inactivo":s>=2?"Repetici\xf3n":1===s?"Activo":"Fallido"}},58111:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(40157).A)("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]])},66828:(e,a,s)=>{Promise.resolve().then(s.bind(s,14701))},73672:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(40157).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},83173:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(40157).A)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},91950:(e,a,s)=>{"use strict";s.d(a,{H:()=>i,s:()=>t});let t=["Confirmado","Procesando","Enviado","Entregado","Facturado"],i=["Programada","Confirmado","Procesando","Enviado","Entregado","Facturado","Fallido","Seguimiento","Cancelado"]}},e=>{var a=a=>e(e.s=a);e.O(0,[2992,7138,5769,8884,1915,1490,587,7328,8965,1859,6874,6060,9105,6315,4697,2583,8441,1684,7358],()=>a(66828)),_N_E=e.O()}]);