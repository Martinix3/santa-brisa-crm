(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9464],{30447:(e,t,a)=>{Promise.resolve().then(a.bind(a,73516))},44838:(e,t,a)=>{"use strict";a.d(t,{Hr:()=>m,Ht:()=>f,SQ:()=>x,_2:()=>h,hO:()=>p,lp:()=>j,mB:()=>v,rI:()=>d,ty:()=>u});var s=a(95155),n=a(12115),r=a(48698),l=a(73158),i=a(10518),o=a(70154),c=a(59434);let d=r.bL,u=r.l9;r.YJ,r.ZL,r.Pb;let m=r.z6;n.forwardRef((e,t)=>{let{className:a,inset:n,children:i,...o}=e;return(0,s.jsxs)(r.ZP,{ref:t,className:(0,c.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",a),...o,children:[i,(0,s.jsx)(l.A,{className:"ml-auto"})]})}).displayName=r.ZP.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.G5,{ref:t,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})}).displayName=r.G5.displayName;let x=n.forwardRef((e,t)=>{let{className:a,sideOffset:n=4,...l}=e;return(0,s.jsx)(r.ZL,{children:(0,s.jsx)(r.UC,{ref:t,sideOffset:n,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});x.displayName=r.UC.displayName;let h=n.forwardRef((e,t)=>{let{className:a,inset:n,...l}=e;return(0,s.jsx)(r.q7,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",a),...l})});h.displayName=r.q7.displayName;let p=n.forwardRef((e,t)=>{let{className:a,children:n,checked:l,...o}=e;return(0,s.jsxs)(r.H_,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:l,...o,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(r.VF,{children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})}),n]})});p.displayName=r.H_.displayName;let f=n.forwardRef((e,t)=>{let{className:a,children:n,...l}=e;return(0,s.jsxs)(r.hN,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(r.VF,{children:(0,s.jsx)(o.A,{className:"h-2 w-2 fill-current"})})}),n]})});f.displayName=r.hN.displayName;let j=n.forwardRef((e,t)=>{let{className:a,inset:n,...l}=e;return(0,s.jsx)(r.JU,{ref:t,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",a),...l})});j.displayName=r.JU.displayName;let v=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...n})});v.displayName=r.wv.displayName},46102:(e,t,a)=>{"use strict";a.d(t,{Bc:()=>i,ZI:()=>d,k$:()=>c,m_:()=>o});var s=a(95155),n=a(12115),r=a(89613),l=a(59434);let i=r.Kq,o=r.bL,c=r.l9,d=n.forwardRef((e,t)=>{let{className:a,sideOffset:n=4,...i}=e;return(0,s.jsx)(r.UC,{ref:t,sideOffset:n,className:(0,l.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})});d.displayName=r.UC.displayName},51894:(e,t,a)=>{"use strict";a.d(t,{i:()=>n});var s=a(34477);let n=(0,s.createServerReference)("7fd3d942ca70288c21ef393a7f2e89fd470d66a73e",s.callServer,void 0,s.findSourceMapURL,"addAccountFS")},73516:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>X});var s=a(95155),n=a(12115),r=a(30285),l=a(66695),i=a(62523),o=a(59409),c=a(87481),d=a(51055),u=a(75074),m=a(34301),x=a(50172),h=a(97538),p=a(65331),f=a(51894),j=a(99058),v=a(34477);let g=(0,v.createServerReference)("7fc4153acdd6088bd66356b4c03986709cf74ebd9d",v.callServer,void 0,v.findSourceMapURL,"deleteAccountFS");var N=a(79557),b=a(16021);let y=(0,v.createServerReference)("70404381813e48759d5f221198ba57abb28d2fad89",v.callServer,void 0,v.findSourceMapURL,"processCarteraData");var w=a(85127),A=a(91394),S=a(96656),C=a(79556),I=a(10518),R=a(17607),D=a(77223),P=a(46102),H=a(59434),T=a(6874),U=a.n(T),_=a(83343),F=a(63482),O=a(80644),E=a(73168),M=a(44861),k=a(61055),z=a(44838);let L=e=>{let{status:t,nextActionType:a,failureReasonType:s}=e;return"Programada"===t&&"Commercial"===e.taskCategory?"Visita Programada":"Programada"===t&&"General"===e.taskCategory?"Tarea Administrativa":"Seguimiento"===t?"Seguimiento (".concat(a||"N/D",")"):"Fallido"===t?"Visita Fallida (".concat(s||"N/D",")"):"Completado"===t?a||s?"Tarea Completada":"Interacci\xf3n Completada":"Confirmado"===t||"Entregado"===t||"Facturado"===t?"Pedido":"Pedido (".concat(t,")")};var V=a(61930),B=a(73672),$=a(8376);function q(e){let{interactions:t}=e,{userRole:a,teamMember:n}=(0,d.A)();return t&&0!==t.length?(0,s.jsxs)("div",{className:"p-4 bg-muted/30 border-t-2 border-primary/20",children:[(0,s.jsx)("h4",{className:"font-semibold mb-2 text-base",children:"Historial de Interacciones"}),(0,s.jsx)("div",{className:"max-h-64 overflow-y-auto",children:(0,s.jsxs)(w.XI,{children:[(0,s.jsx)(w.A0,{children:(0,s.jsxs)(w.Hj,{children:[(0,s.jsx)(w.nd,{children:"Fecha"}),(0,s.jsx)(w.nd,{children:"Tipo / Resultado"}),(0,s.jsx)(w.nd,{children:"Valor"}),(0,s.jsx)(w.nd,{children:"Comercial"}),(0,s.jsx)(w.nd,{children:"Notas"}),(0,s.jsx)(w.nd,{className:"text-right",children:"Acciones"})]})}),(0,s.jsx)(w.BF,{children:t.slice(0,10).map(e=>{let t=["Programada","Seguimiento"].includes(e.status),l="Admin"===a||"SalesRep"===a&&(null==n?void 0:n.name)===e.salesRep||"Clavadista"===a&&e.clavadistaId===(null==n?void 0:n.id);return(0,s.jsxs)(w.Hj,{children:[(0,s.jsx)(w.nA,{children:(0,M.f)((0,_.H)(e.createdAt))?(0,E.GP)((0,_.H)(e.createdAt),"dd/MM/yy HH:mm",{locale:k.es}):"N/D"}),(0,s.jsx)(w.nA,{children:L(e)}),(0,s.jsx)(w.nA,{children:(0,s.jsx)(V.A,{value:e.value,options:{style:"currency",currency:"EUR"},placeholder:"—"})}),(0,s.jsx)(w.nA,{children:e.salesRep}),(0,s.jsx)(w.nA,{className:"text-xs max-w-[150px] truncate",title:e.notes,children:e.notes||"N/A"}),(0,s.jsx)(w.nA,{className:"text-right",children:t&&l?(0,s.jsx)(r.$,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsxs)(U(),{href:"/order-form?originatingTaskId=".concat(e.id),children:[(0,s.jsx)(B.A,{className:"mr-1 h-3 w-3"})," Registrar Resultado"]})}):(0,s.jsxs)(r.$,{variant:"ghost",size:"sm",disabled:!0,children:[(0,s.jsx)($.A,{className:"mr-1 h-3 w-3 text-green-500"})," Gestionado"]})})]},e.id)})})]})}),t.length>10&&(0,s.jsx)("p",{className:"text-center text-xs text-muted-foreground mt-2",children:"Mostrando las 10 interacciones m\xe1s recientes."})]}):(0,s.jsx)("div",{className:"text-center text-sm text-muted-foreground p-4",children:"No hay historial de interacciones para esta cuenta."})}let G=e=>{var t,a,l,i;let{account:o,allTeamMembers:c,onResponsibleUpdate:u,onOpenFollowUpDialog:x,onDeleteAccount:h}=e,{userRole:p}=(0,d.A)(),f="Admin"===p,j=c.filter(e=>"Admin"===e.role||"SalesRep"===e.role),[v,g]=n.useState(!1),N=async e=>{await u(o.id,"##NONE##"===e?null:e)},b=(null==(t=o.nextInteraction)?void 0:t.status)==="Programada"?o.nextInteraction.visitDate?(0,_.H)(o.nextInteraction.visitDate):null:(null==(a=o.nextInteraction)?void 0:a.nextActionDate)?(0,_.H)(o.nextInteraction.nextActionDate):null,y=!!b&&(0,F.Y)(b,(0,O.o)(new Date)),T=o.leadScore>75?"bg-green-500":o.leadScore>40?"bg-yellow-500":"bg-red-500",V=o.interactions.length>0?o.interactions[0]:null;return(0,s.jsx)(P.Bc,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(w.Hj,{className:(0,H.cn)("border-b align-top",y&&"bg-rose-50/50 dark:bg-rose-900/10"),children:[(0,s.jsx)(w.nA,{className:"font-medium p-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>g(!v),disabled:0===o.interactions.length,children:(0,s.jsx)(C.A,{className:(0,H.cn)("h-4 w-4 transition-transform",v&&"rotate-180",0===o.interactions.length&&"opacity-30")})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)(U(),{href:"/accounts/".concat(o.id),className:"hover:underline text-primary text-base font-semibold",children:o.nombre}),(0,s.jsx)(S.A,{type:"account",status:o.status})]})]})}),(0,s.jsx)(w.nA,{className:"p-3",children:f?(0,s.jsxs)(z.rI,{children:[(0,s.jsx)(z.ty,{asChild:!0,children:(0,s.jsxs)(r.$,{variant:"ghost",className:"h-auto p-1 -ml-1 flex items-center gap-2",children:[(0,s.jsxs)(A.eu,{className:"h-7 w-7",children:[(0,s.jsx)(A.BK,{src:o.responsableAvatar,"data-ai-hint":"person face"}),(0,s.jsx)(A.q5,{className:"text-xs",children:(null==(l=o.responsableName)?void 0:l.split(" ").map(e=>e[0]).join(""))||"S/A"})]}),(0,s.jsx)("span",{className:"text-sm truncate",children:o.responsableName||"Sin Asignar"})]})}),(0,s.jsx)(z.SQ,{children:(0,s.jsxs)(z.Hr,{value:o.responsableId||"##NONE##",onValueChange:N,children:[(0,s.jsx)(z.Ht,{value:"##NONE##",children:"Sin Asignar"}),j.map(e=>(0,s.jsx)(z.Ht,{value:e.id,children:e.name},e.id))]})})]}):(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(A.eu,{className:"h-7 w-7",children:[(0,s.jsx)(A.BK,{src:o.responsableAvatar,"data-ai-hint":"person face"}),(0,s.jsx)(A.q5,{className:"text-xs",children:(null==(i=o.responsableName)?void 0:i.split(" ").map(e=>e[0]).join(""))||"S/A"})]}),(0,s.jsx)("span",{className:"text-sm truncate",children:o.responsableName||"Sin Asignar"})]})}),(0,s.jsx)(w.nA,{className:"p-3 text-sm",children:V?(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground truncate",title:L(V),children:L(V)}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground/80",children:(0,E.GP)((0,_.H)(V.createdAt),"dd MMM yyyy",{locale:k.es})})]}):(0,s.jsx)("span",{className:"text-muted-foreground",children:"—"})}),(0,s.jsx)(w.nA,{className:"p-3 text-sm",children:o.nextInteraction?(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground truncate",title:L(o.nextInteraction),children:L(o.nextInteraction)}),b&&(0,M.f)(b)&&(0,s.jsx)("p",{className:(0,H.cn)("text-xs",y?"text-red-600 font-semibold":"text-muted-foreground/80"),children:(0,E.GP)(b,"dd MMM yyyy",{locale:k.es})})]}),(0,s.jsxs)(r.$,{variant:"outline",size:"sm",onClick:()=>x(o.nextInteraction),children:[(0,s.jsx)(I.A,{className:"mr-1 h-4 w-4"})," Completar"]})]}):(0,s.jsx)(r.$,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsxs)(U(),{href:"/order-form?accountId=".concat(o.id),children:[(0,s.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Registrar"]})})}),(0,s.jsx)(w.nA,{className:"text-center p-3",children:(0,s.jsxs)(P.m_,{children:[(0,s.jsx)(P.k$,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-1.5",children:[(0,s.jsx)("div",{className:(0,H.cn)("h-2.5 w-2.5 rounded-full",T)}),(0,s.jsx)("span",{className:"font-semibold",children:o.leadScore})]})}),(0,s.jsx)(P.ZI,{children:(0,s.jsx)("p",{children:"Puntuaci\xf3n de Prioridad"})})]})}),(0,s.jsx)(w.nA,{className:"p-3",children:o.ciudad||"N/D"}),(0,s.jsx)(w.nA,{className:"text-right pr-4 p-3",children:(0,s.jsxs)(z.rI,{children:[(0,s.jsx)(z.ty,{asChild:!0,children:(0,s.jsx)(r.$,{variant:"ghost",size:"icon",children:(0,s.jsx)(R.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(z.SQ,{align:"end",children:[(0,s.jsx)(z._2,{asChild:!0,children:(0,s.jsxs)(U(),{href:"/accounts/".concat(o.id),children:[(0,s.jsx)(R.A,{className:"mr-2 h-4 w-4"}),"Ver Ficha Completa"]})}),(0,s.jsx)(z.mB,{}),(0,s.jsx)(z._2,{asChild:!0,children:(0,s.jsxs)(U(),{href:"/order-form?accountId=".concat(o.id),children:[(0,s.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Registrar Interacci\xf3n"]})}),f&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.mB,{}),(0,s.jsxs)(z._2,{className:"text-destructive focus:text-destructive focus:bg-destructive/10",onSelect:e=>{e.preventDefault(),h(o)},children:[(0,s.jsx)(D.A,{className:"mr-2 h-4 w-4"}),"Eliminar Cuenta"]})]})]})]})})]}),v&&(0,s.jsx)(w.Hj,{children:(0,s.jsx)(w.nA,{colSpan:7,className:"p-0",children:(0,s.jsx)(q,{interactions:o.interactions})})})]})})};var Z=a(76322),J=a(82083),K=a(56104),Q=a(35317),Y=a(71280),W=a(90010);function X(){let{toast:e}=(0,c.dj)(),{userRole:t,teamMember:a,dataSignature:v,refreshDataSignature:w}=(0,d.A)(),[A,S]=n.useState([]),[C,I]=n.useState([]),[R,D]=n.useState(!0),[P,H]=n.useState(!1),[T,U]=n.useState(!1),[k,z]=n.useState(null),[L,V]=n.useState(null),[B,$]=n.useState(""),[q,G]=n.useState("Todos"),[X,et]=n.useState("Todos"),[ea,es]=n.useState("leadScore_desc"),en="Admin"===t,er=C.filter(e=>"Admin"===e.role||"SalesRep"===e.role);n.useEffect(()=>{!async function(){D(!0);try{let[e,s,n]=await Promise.all([(0,p.U)(),(0,N.r)(),(0,b.I)(["SalesRep","Admin","Clavadista"])]),r=await y(e,s,n);if("Clavadista"===t&&(null==a?void 0:a.id)){let e=new Set;s.forEach(t=>{t.clavadistaId===a.id&&t.accountId&&e.add(t.accountId)}),r=r.filter(t=>e.has(t.id))}S(r),I(n)}catch(t){console.error("Error fetching data:",t),e({title:"Error al Cargar Datos",description:"No se pudieron cargar los datos de la cartera.",variant:"destructive"})}finally{D(!1)}}()},[e,v,t,a]);let{activeAccounts:el,potentialAccounts:ei,pendingAccounts:eo,failedAccounts:ec,inactiveAccounts:ed}=n.useMemo(()=>{let e=(0,O.o)(new Date),t=(0,Z.D)(new Date),a=(e,t)=>{switch(ea){case"nextAction_asc":{var a,s,n,r;let l=(null==(a=e.nextInteraction)?void 0:a.status)==="Programada"?e.nextInteraction.visitDate?(0,_.H)(e.nextInteraction.visitDate):null:(null==(s=e.nextInteraction)?void 0:s.nextActionDate)?(0,_.H)(e.nextInteraction.nextActionDate):null,i=(null==(n=t.nextInteraction)?void 0:n.status)==="Programada"?t.nextInteraction.visitDate?(0,_.H)(t.nextInteraction.visitDate):null:(null==(r=t.nextInteraction)?void 0:r.nextActionDate)?(0,_.H)(t.nextInteraction.nextActionDate):null;if(!l&&!i)return 0;if(!l)return 1;if(!i)return -1;if(!(0,M.f)(l))return 1;if(!(0,M.f)(i))return -1;return l.getTime()-i.getTime()}case"lastInteraction_desc":{let a=e.lastInteractionDate,s=t.lastInteractionDate;if(!a&&!s)return 0;if(!a)return 1;if(!s)return -1;if(!(0,M.f)(a))return 1;if(!(0,M.f)(s))return -1;return s.getTime()-a.getTime()}default:return t.leadScore-e.leadScore}},s=A.filter(e=>{if(!B)return!0;let t=B.toLowerCase();return e.nombre.toLowerCase().includes(t)||e.cif&&e.cif.toLowerCase().includes(t)||e.responsableName&&e.responsableName.toLowerCase().includes(t)||e.ciudad&&e.ciudad.toLowerCase().includes(t)}).filter(e=>!en||"Todos"===q||("SinAsignar"===q?!e.responsableId:e.responsableId===q)).filter(a=>{var s,n;if("Todos"===X)return!0;if(!["Programada","Seguimiento"].includes(a.status))return!1;let r=(null==(s=a.nextInteraction)?void 0:s.status)==="Programada"?a.nextInteraction.visitDate?(0,_.H)(a.nextInteraction.visitDate):null:(null==(n=a.nextInteraction)?void 0:n.nextActionDate)?(0,_.H)(a.nextInteraction.nextActionDate):null;return!!r&&!!(0,M.f)(r)&&("Vencidas"===X?(0,F.Y)(r,e):"Para Hoy"===X?(0,J.n)((0,O.o)(r),e):"Pendientes"===X&&r>t)}),n=e=>["Activo","Repetici\xf3n"].includes(e.status),r=e=>"Inactivo"===e.status,l=e=>"Seguimiento"===e.status,i=e=>"Programada"===e.status||"Pendiente (Sin Interacci\xf3n)"===e.status,o=e=>"Fallido"===e.status;return{activeAccounts:s.filter(e=>n(e)).sort(a),potentialAccounts:s.filter(e=>l(e)).sort(a),pendingAccounts:s.filter(e=>i(e)).sort(a),failedAccounts:s.filter(e=>o(e)).sort(a),inactiveAccounts:s.filter(e=>r(e)).sort(a)}},[B,A,q,X,en,ea]),eu=async t=>{if(en){D(!0);try{await (0,f.i)(t),w(),e({title:"\xa1Cuenta A\xf1adida!",description:'La cuenta "'.concat(t.name,'" ha sido a\xf1adida.')}),H(!1)}catch(t){console.error("Error saving new account:",t),e({title:"Error al Guardar",description:"No se pudo a\xf1adir la nueva cuenta.",variant:"destructive"})}finally{D(!1)}}},em=async(t,a)=>{try{await (0,j.k)(t,{salesRepId:null===a?void 0:a}),w(),e({title:"Responsable Actualizado",description:"Se ha reasignado la cuenta correctamente."})}catch(t){console.error("Error updating responsible:",t),e({title:"Error al Reasignar",description:"No se pudo actualizar el responsable.",variant:"destructive"})}},ex=e=>{z(e),U(!0)},eh=async(t,s)=>{try{await (0,Q.c4)(K.db,async e=>{let n=(0,Q.H9)(K.db,"orders",s.id);e.update(n,{status:"Completado",lastUpdated:new Date});let r=(0,Q.H9)((0,Q.rJ)(K.db,"orders")),l=(t.numberOfUnits||0)*(t.unitPrice||0),i=s.salesRep;if(t.assignedSalesRepId&&i!==(null==a?void 0:a.name)){let e=C.find(e=>e.id===t.assignedSalesRepId);e&&(i=e.name)}let o={clientName:s.clientName,accountId:s.accountId||null,createdAt:new Date,lastUpdated:new Date,salesRep:i,clavadistaId:s.clavadistaId||null,clientStatus:"existing",originatingTaskId:s.id,notes:t.notes||null};"successful"===t.outcome?(o.status="Confirmado",o.visitDate=new Date,o.products=["Santa Brisa 750ml"],o.numberOfUnits=t.numberOfUnits,o.unitPrice=t.unitPrice,o.value=1.21*l,o.paymentMethod=t.paymentMethod):"follow-up"===t.outcome?(o.status="Seguimiento",o.nextActionType=t.nextActionType,o.nextActionCustom="Opci\xf3n personalizada"===t.nextActionType?t.nextActionCustom:null,o.nextActionDate=t.nextActionDate?(0,E.GP)(t.nextActionDate,"yyyy-MM-dd"):null,o.visitDate=null):"failed"===t.outcome&&(o.status="Fallido",o.visitDate=new Date,o.failureReasonType=t.failureReasonType,o.failureReasonCustom="Otro (especificar)"===t.failureReasonType?t.failureReasonCustom:null),e.set(r,o)}),e({title:"Interacci\xf3n Registrada",description:"Se ha guardado el resultado y actualizado la cartera."}),w()}catch(t){console.error("Transaction failed: ",t),e({title:"Error en la transacci\xf3n",description:"No se pudo guardar el resultado.",variant:"destructive"})}finally{U(!1),z(null)}},ep=e=>{en&&V(e)},ef=async()=>{if(en&&L){D(!0);try{await g(L.id),e({title:"\xa1Cuenta Eliminada!",description:'La cuenta "'.concat(L.nombre,'" y sus interacciones asociadas han sido eliminadas.'),variant:"destructive"}),w()}catch(t){console.error("Error deleting account:",t),e({title:"Error al Eliminar",description:"No se pudo eliminar la cuenta y sus interacciones.",variant:"destructive"})}finally{D(!1),V(null)}}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("header",{children:[(0,s.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Cuentas y Seguimiento"}),(0,s.jsx)(l.BT,{children:"Gestiona tus cuentas, programa visitas y haz seguimiento de tus tareas comerciales."})]}),(0,s.jsxs)(l.Zp,{className:"shadow-subtle hover:shadow-md transition-shadow duration-300",children:[(0,s.jsx)(l.aR,{children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-4 flex-wrap",children:[(0,s.jsxs)("div",{className:"relative flex-grow w-full sm:w-auto",children:[(0,s.jsx)(u.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(i.p,{placeholder:"Buscar cuenta, CIF, ciudad...",value:B,onChange:e=>$(e.target.value),className:"pl-9 w-full sm:max-w-xs"})]}),(0,s.jsxs)(o.l6,{value:X,onValueChange:e=>et(e),children:[(0,s.jsx)(o.bq,{className:"w-full sm:w-[180px]",children:(0,s.jsx)(o.yv,{placeholder:"Filtrar por fecha..."})}),(0,s.jsxs)(o.gC,{children:[(0,s.jsx)(o.eb,{value:"Todos",children:"Todas las Tareas"}),(0,s.jsx)(o.eb,{value:"Vencidas",children:"Vencidas"}),(0,s.jsx)(o.eb,{value:"Para Hoy",children:"Para Hoy"}),(0,s.jsx)(o.eb,{value:"Pendientes",children:"Pendientes"})]})]}),en&&(0,s.jsxs)(o.l6,{value:q,onValueChange:G,children:[(0,s.jsx)(o.bq,{className:"w-full sm:w-[180px]",children:(0,s.jsx)(o.yv,{placeholder:"Filtrar responsable..."})}),(0,s.jsxs)(o.gC,{children:[(0,s.jsx)(o.eb,{value:"Todos",children:"Todos los Responsables"}),(0,s.jsx)(o.eb,{value:"SinAsignar",children:"Sin Asignar"}),er.map(e=>(0,s.jsx)(o.eb,{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)(o.l6,{value:ea,onValueChange:e=>es(e),children:[(0,s.jsx)(o.bq,{className:"w-full sm:w-[240px]",children:(0,s.jsx)(o.yv,{placeholder:"Ordenar por..."})}),(0,s.jsxs)(o.gC,{children:[(0,s.jsx)(o.eb,{value:"leadScore_desc",children:"Prioridad (Lead Score)"}),(0,s.jsx)(o.eb,{value:"nextAction_asc",children:"Fecha Pr\xf3xima Tarea"}),(0,s.jsx)(o.eb,{value:"lastInteraction_desc",children:"Fecha \xdaltima Interacci\xf3n"})]})]}),(0,s.jsx)("div",{className:"flex-grow flex justify-end gap-2 w-full sm:w-auto",children:en&&(0,s.jsxs)(r.$,{onClick:()=>{en&&H(!0)},disabled:R,children:[(0,s.jsx)(m.A,{className:"mr-2 h-4 w-4"})," A\xf1adir Cuenta Manual"]})})]})}),(0,s.jsx)(l.Wu,{children:(0,s.jsx)("div",{className:"overflow-x-auto",children:R?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)(x.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,s.jsxs)("table",{className:"min-w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b-0",children:[(0,s.jsx)("th",{className:"w-[25%] text-left font-medium text-muted-foreground p-2",children:"Cuenta"}),(0,s.jsx)("th",{className:"w-[15%] text-left font-medium text-muted-foreground p-2",children:"Responsable"}),(0,s.jsx)("th",{className:"w-[15%] text-left font-medium text-muted-foreground p-2",children:"\xdaltima Interacci\xf3n"}),(0,s.jsx)("th",{className:"w-[20%] text-left font-medium text-muted-foreground p-2",children:"Pr\xf3xima Tarea"}),(0,s.jsx)("th",{className:"w-[10%] text-center font-medium text-muted-foreground p-2",children:"Lead Score"}),(0,s.jsx)("th",{className:"w-[10%] text-left font-medium text-muted-foreground p-2",children:"Ciudad"}),(0,s.jsx)("th",{className:"w-[5%] text-right pr-4 font-medium text-muted-foreground p-2",children:"Acciones"})]})}),(0,s.jsx)(ee,{title:"Cuentas Activas (y Repetici\xf3n)",accounts:el,teamMembers:C,onResponsibleUpdate:em,onOpenFollowUpDialog:ex,onDeleteAccount:ep}),(0,s.jsx)(ee,{title:"Potenciales (en seguimiento)",accounts:ei,teamMembers:C,onResponsibleUpdate:em,onOpenFollowUpDialog:ex,onDeleteAccount:ep}),(0,s.jsx)(ee,{title:"Pendientes (Visitas Programadas / Nuevas)",accounts:eo,teamMembers:C,onResponsibleUpdate:em,onOpenFollowUpDialog:ex,onDeleteAccount:ep}),(0,s.jsx)(ee,{title:"Cuentas Inactivas",accounts:ed,teamMembers:C,onResponsibleUpdate:em,onOpenFollowUpDialog:ex,onDeleteAccount:ep}),(0,s.jsx)(ee,{title:"Fallidos / Descartados",accounts:ec,teamMembers:C,onResponsibleUpdate:em,onOpenFollowUpDialog:ex,onDeleteAccount:ep})]})})})]}),en&&(0,s.jsx)(h.A,{account:null,isOpen:P,onOpenChange:H,onSave:eu,allAccounts:A}),k&&(0,s.jsx)(Y.A,{order:k,isOpen:T,onOpenChange:U,onSave:eh,allTeamMembers:C,currentUser:a,currentUserRole:t}),L&&(0,s.jsx)(W.Lt,{open:!!L,onOpenChange:e=>!e&&V(null),children:(0,s.jsxs)(W.EO,{children:[(0,s.jsxs)(W.wd,{children:[(0,s.jsx)(W.r7,{children:"\xbfEst\xe1s realmente seguro?"}),(0,s.jsxs)(W.$v,{children:["Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente la cuenta ",(0,s.jsxs)("strong",{className:"text-foreground",children:['"',L.nombre,'"']})," y todas sus interacciones asociadas."]})]}),(0,s.jsxs)(W.ck,{children:[(0,s.jsx)(W.Zr,{onClick:()=>V(null),children:"Cancelar"}),(0,s.jsx)(W.Rx,{onClick:ef,variant:"destructive",children:"S\xed, eliminar todo"})]})]})})]})}let ee=e=>{let{title:t,accounts:a,teamMembers:l,onResponsibleUpdate:i,onOpenFollowUpDialog:o,onDeleteAccount:c}=e,[d,u]=n.useState(!1),m=a.length>5,x=d?a:a.slice(0,5);return 0===a.length?null:(0,s.jsxs)("tbody",{className:"group/tbody",children:[(0,s.jsx)("tr",{className:"bg-muted/30 hover:bg-muted/30",children:(0,s.jsx)("td",{colSpan:7,className:"p-0",children:(0,s.jsxs)("div",{className:"py-2 px-2 flex justify-between items-center",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-700",children:[t," (",a.length,")"]}),m&&(0,s.jsx)(r.$,{variant:"link",size:"sm",onClick:()=>u(!d),children:d?"Ver menos":"Ver ".concat(a.length-5," m\xe1s...")})]})})}),x.map(e=>(0,s.jsx)(G,{account:e,allTeamMembers:l,onResponsibleUpdate:i,onOpenFollowUpDialog:o,onDeleteAccount:c},e.id))]})}},91394:(e,t,a)=>{"use strict";a.d(t,{BK:()=>o,eu:()=>i,q5:()=>c});var s=a(95155),n=a(12115),r=a(54011),l=a(59434);let i=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.bL,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...n})});i.displayName=r.bL.displayName;let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r._V,{ref:t,className:(0,l.cn)("aspect-square h-full w-full",a),...n})});o.displayName=r._V.displayName;let c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.H4,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...n})});c.displayName=r.H4.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7138,5769,8884,1915,1490,587,7328,8965,1859,6874,6060,6764,8782,6723,5275,5424,6315,1549,4697,8347,8441,1684,7358],()=>t(30447)),_N_E=e.O()}]);