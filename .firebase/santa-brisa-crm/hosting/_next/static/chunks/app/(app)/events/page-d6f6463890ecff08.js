(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1149],{3561:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},9572:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},10418:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>$});var s=a(95155),n=a(12115),r=a(30285),i=a(66695),l=a(85127),c=a(44838),d=a(62523),o=a(87481),h=a(93473),u=a(51055),m=a(58111),x=a(34301),v=a(9572),p=a(79556),j=a(50172),N=a(83173),f=a(3561),y=a(17607),g=a(18763),w=a(77223),k=a(73221),A=a(90010),C=a(73168),E=a(83343),M=a(61055),b=a(96656),D=a(16021),T=a(65331),S=a(34477);let I=(0,S.createServerReference)("7fd5ae6c54827844d0fdf9e5f31d2c3bc5bb814fdd",S.callServer,void 0,S.findSourceMapURL,"initializeMockEventsInFirestore");var z=a(12372),U=a(54951),F=a(53359),Z=a(1741),H=a(6874),L=a.n(H);function $(){let{toast:e}=(0,o.dj)(),{userRole:t,teamMember:a}=(0,u.A)(),[S,H]=n.useState([]),[$,q]=n.useState([]),[O,P]=n.useState([]),[_,V]=n.useState(!0),[B,R]=n.useState(null),[G,Y]=n.useState(!1),[Q,W]=n.useState(!1),[X,J]=n.useState(null),[K,ee]=n.useState(""),[et,ea]=n.useState("Todos"),[es,en]=n.useState("Todos"),er="Admin"===t;n.useEffect(()=>{!async function(){V(!0);try{await I(h.gN);let[e,s,n]=await Promise.all([(0,z.r)(),(0,D.I)(),(0,T.U)()]);"Clavadista"===t&&a?H(e.filter(e=>e.assignedTeamMemberIds.includes(a.id))):H(e),q(s),P(n)}catch(t){console.error("Failed to load events or team members:",t),e({title:"Error",description:"No se pudieron cargar los eventos o miembros del equipo.",variant:"destructive"})}finally{V(!1)}}()},[e,t,a]);let ei=e=>{R(e),W(!0),Y(!0)},el=e=>{er&&(R(e),W(!1),Y(!0))},ec=async(s,n)=>{if(er||n){if(!er&&n){V(!1),e({title:"Acci\xf3n no permitida",description:"No tienes permiso para editar eventos.",variant:"destructive"});return}V(!0);try{let r="";n?(await (0,U.T)(n,s),r='El evento "'.concat(s.name,'" ha sido actualizado.')):(await (0,F.Z)(s),r='El evento "'.concat(s.name,'" ha sido a\xf1adido.'));let i=await (0,z.r)();"Clavadista"===t&&a?H(i.filter(e=>e.assignedTeamMemberIds.includes(a.id))):H(i),e({title:"\xa1Operaci\xf3n Exitosa!",description:r}),Y(!1),R(null)}catch(t){console.error("Error saving event:",t),e({title:"Error al Guardar",description:"No se pudo guardar el evento en Firestore.",variant:"destructive"})}finally{V(!1)}}},ed=e=>{er&&J(e)},eo=async()=>{if(er&&X){V(!0);try{await (0,Z.$)(X.id),H(e=>e.filter(e=>e.id!==X.id)),e({title:"\xa1Evento Eliminado!",description:'El evento "'.concat(X.name,'" ha sido eliminado.'),variant:"destructive"})}catch(t){console.error("Error deleting event:",t),e({title:"Error al Eliminar",description:"No se pudo eliminar el evento de Firestore.",variant:"destructive"})}finally{V(!1),J(null)}}},eh=n.useCallback(e=>e&&0!==e.length&&0!==$.length&&e.map(e=>{var t;return null==(t=$.find(t=>t.id===e))?void 0:t.name}).filter(e=>!!e).join(", ")||"N/A",[$]),eu=["Todos",...h.l],em=["Todos",...h.Ly],ex=S.filter(e=>e.name.toLowerCase().includes(K.toLowerCase())||e.location&&e.location.toLowerCase().includes(K.toLowerCase())).filter(e=>"Todos"===et||e.type===et).filter(e=>"Todos"===es||e.status===es);return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("header",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.A,{className:"h-8 w-8 text-primary"}),(0,s.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Calendario y Gesti\xf3n de Eventos"})]}),er&&(0,s.jsxs)(r.$,{onClick:()=>{er&&(R(null),W(!1),Y(!0))},disabled:_,children:[(0,s.jsx)(x.A,{className:"mr-2 h-4 w-4"})," A\xf1adir Nuevo Evento"]})]}),(0,s.jsxs)(i.Zp,{className:"shadow-subtle hover:shadow-md transition-shadow duration-300",children:[(0,s.jsxs)(i.aR,{children:[(0,s.jsx)(i.ZB,{children:"Lista de Eventos"}),(0,s.jsx)(i.BT,{children:"Clavadista"===t?"Visualiza los eventos de marketing y comerciales en los que est\xe1s asignado.":"Organiza, visualiza y gestiona todos los eventos de marketing y comerciales. Los administradores pueden a\xf1adir, editar y eliminar eventos."})]}),(0,s.jsxs)(i.Wu,{children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-4 mb-6",children:[(0,s.jsx)(d.p,{placeholder:"Buscar eventos (Nombre, Ubicaci\xf3n)...",value:K,onChange:e=>ee(e.target.value),className:"max-w-sm"}),(0,s.jsxs)(c.rI,{children:[(0,s.jsx)(c.ty,{asChild:!0,children:(0,s.jsxs)(r.$,{variant:"outline",className:"w-full sm:w-auto",children:[(0,s.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Tipo: ",et," ",(0,s.jsx)(p.A,{className:"ml-2 h-4 w-4"})]})}),(0,s.jsx)(c.SQ,{align:"start",children:eu.map(e=>(0,s.jsx)(c.hO,{checked:et===e,onCheckedChange:()=>ea(e),children:e},e))})]}),(0,s.jsxs)(c.rI,{children:[(0,s.jsx)(c.ty,{asChild:!0,children:(0,s.jsxs)(r.$,{variant:"outline",className:"w-full sm:w-auto",children:[(0,s.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Estado: ",es," ",(0,s.jsx)(p.A,{className:"ml-2 h-4 w-4"})]})}),(0,s.jsx)(c.SQ,{align:"start",children:em.map(e=>(0,s.jsx)(c.hO,{checked:es===e,onCheckedChange:()=>en(e),children:e},e))})]})]}),_?(0,s.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,s.jsx)(j.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ml-4 text-muted-foreground",children:"Cargando eventos..."})]}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(l.XI,{children:[(0,s.jsx)(l.A0,{children:(0,s.jsxs)(l.Hj,{children:[(0,s.jsx)(l.nd,{className:"w-[25%]",children:"Nombre del Evento"}),(0,s.jsx)(l.nd,{className:"w-[15%]",children:"Fechas"}),(0,s.jsx)(l.nd,{className:"w-[20%]",children:"Cuenta Vinculada"}),(0,s.jsx)(l.nd,{className:"w-[15%]",children:"Responsables"}),(0,s.jsx)(l.nd,{className:"text-center w-[10%]",children:"Estado"}),(0,s.jsx)(l.nd,{className:"text-right w-[15%]",children:"Acciones"})]})}),(0,s.jsx)(l.BF,{children:ex.length>0?ex.map(e=>(0,s.jsxs)(l.Hj,{children:[(0,s.jsx)(l.nA,{className:"font-medium",children:e.name}),(0,s.jsxs)(l.nA,{children:[(0,C.GP)((0,E.H)(e.startDate),"dd/MM/yy",{locale:M.es}),e.endDate&&e.endDate!==e.startDate?" - ".concat((0,C.GP)((0,E.H)(e.endDate),"dd/MM/yy",{locale:M.es})):""]}),(0,s.jsx)(l.nA,{children:e.accountId&&e.accountName?(0,s.jsxs)(L(),{href:"/accounts/".concat(e.accountId),className:"hover:underline text-primary flex items-center gap-1.5 text-xs",children:[(0,s.jsx)(N.A,{className:"h-3 w-3"}),e.accountName]}):(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"N/A"})}),(0,s.jsx)(l.nA,{className:"text-xs truncate max-w-[200px]",title:eh(e.assignedTeamMemberIds),children:eh(e.assignedTeamMemberIds)}),(0,s.jsx)(l.nA,{className:"text-center",children:(0,s.jsx)(b.A,{type:"event",status:e.status})}),(0,s.jsx)(l.nA,{className:"text-right",children:(0,s.jsxs)(c.rI,{children:[(0,s.jsx)(c.ty,{asChild:!0,children:(0,s.jsxs)(r.$,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,s.jsx)("span",{className:"sr-only",children:"Abrir men\xfa"}),(0,s.jsx)(f.A,{className:"h-4 w-4"})]})}),(0,s.jsxs)(c.SQ,{align:"end",children:[(0,s.jsxs)(c._2,{onSelect:()=>ei(e),children:[(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Ver Detalles"]}),er&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c._2,{onSelect:()=>el(e),children:[(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Editar Evento"]}),(0,s.jsx)(c.mB,{}),(0,s.jsxs)(A.Lt,{children:[(0,s.jsx)(A.tv,{asChild:!0,children:(0,s.jsxs)(c._2,{className:"text-destructive focus:text-destructive focus:bg-destructive/10",onSelect:t=>{t.preventDefault(),ed(e)},children:[(0,s.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Eliminar Evento"]})}),X&&X.id===e.id&&(0,s.jsxs)(A.EO,{children:[(0,s.jsxs)(A.wd,{children:[(0,s.jsx)(A.r7,{children:"\xbfEst\xe1s seguro?"}),(0,s.jsxs)(A.$v,{children:["Esta acci\xf3n no se puede deshacer. Esto eliminar\xe1 permanentemente el evento:",(0,s.jsx)("br",{}),(0,s.jsxs)("strong",{className:"mt-2 block",children:['"',X.name,'"']})]})]}),(0,s.jsxs)(A.ck,{children:[(0,s.jsx)(A.Zr,{onClick:()=>J(null),children:"Cancelar"}),(0,s.jsx)(A.Rx,{onClick:eo,variant:"destructive",children:"S\xed, eliminar"})]})]})]})]})]})]})})]},e.id)):(0,s.jsx)(l.Hj,{children:(0,s.jsxs)(l.nA,{colSpan:6,className:"h-24 text-center",children:["No se encontraron eventos que coincidan con tu b\xfasqueda o filtros. ",er?"Puedes a\xf1adir un nuevo evento.":"Clavadista"===t?"No tienes eventos asignados que coincidan.":""]})})})]})})]}),!_&&ex.length>0&&(0,s.jsx)(i.wL,{children:(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Total de eventos mostrados: ",ex.length," de ",S.length]})})]}),(0,s.jsx)(k.A,{event:B,isOpen:G,onOpenChange:e=>{Y(e),e||(R(null),W(!1))},onSave:ec,isReadOnly:Q||!er&&!!B,allTeamMembers:$,allAccounts:O})]})}},17607:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},18763:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},35184:(e,t,a)=>{Promise.resolve().then(a.bind(a,10418))},57082:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]])},58111:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]])},82083:(e,t,a)=>{"use strict";a.d(t,{n:()=>n});var s=a(35476);function n(e,t){return+(0,s.a)(e)==+(0,s.a)(t)}},83173:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},83343:(e,t,a)=>{"use strict";a.d(t,{H:()=>n});var s=a(41876);function n(e,t){var a;let n,m,x=null!=(a=null==t?void 0:t.additionalDigits)?a:2,v=function(e){let t,a={},s=e.split(r.dateTimeDelimiter);if(s.length>2)return a;if(/:/.test(s[0])?t=s[0]:(a.date=s[0],t=s[1],r.timeZoneDelimiter.test(a.date)&&(a.date=e.split(r.timeZoneDelimiter)[0],t=e.substr(a.date.length,e.length))),t){let e=r.timezone.exec(t);e?(a.time=t.replace(e[1],""),a.timezone=e[1]):a.time=t}return a}(e);if(v.date){let e=function(e,t){let a=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(a);if(!s)return{year:NaN,restDateString:""};let n=s[1]?parseInt(s[1]):null,r=s[2]?parseInt(s[2]):null;return{year:null===r?n:100*r,restDateString:e.slice((s[1]||s[2]).length)}}(v.date,x);n=function(e,t){var a,s,n,r,l,c,o,m;if(null===t)return new Date(NaN);let x=e.match(i);if(!x)return new Date(NaN);let v=!!x[4],p=d(x[1]),j=d(x[2])-1,N=d(x[3]),f=d(x[4]),y=d(x[5])-1;if(v){return(a=0,s=f,n=y,s>=1&&s<=53&&n>=0&&n<=6)?function(e,t,a){let s=new Date(0);s.setUTCFullYear(e,0,4);let n=s.getUTCDay()||7;return s.setUTCDate(s.getUTCDate()+((t-1)*7+a+1-n)),s}(t,f,y):new Date(NaN)}{let e=new Date(0);return(r=t,l=j,c=N,l>=0&&l<=11&&c>=1&&c<=(h[l]||(u(r)?29:28))&&(o=t,(m=p)>=1&&m<=(u(o)?366:365)))?(e.setUTCFullYear(t,j,Math.max(p,N)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);let p=n.getTime(),j=0;if(v.time&&isNaN(j=function(e){var t,a,n;let r=e.match(l);if(!r)return NaN;let i=o(r[1]),c=o(r[2]),d=o(r[3]);return(t=i,a=c,n=d,24===t?0===a&&0===n:n>=0&&n<60&&a>=0&&a<60&&t>=0&&t<25)?i*s.s0+c*s.Cg+1e3*d:NaN}(v.time)))return new Date(NaN);if(v.timezone){if(isNaN(m=function(e){var t,a;if("Z"===e)return 0;let n=e.match(c);if(!n)return 0;let r="+"===n[1]?-1:1,i=parseInt(n[2]),l=n[3]&&parseInt(n[3])||0;return(t=0,(a=l)>=0&&a<=59)?r*(i*s.s0+l*s.Cg):NaN}(v.timezone)))return new Date(NaN)}else{let e=new Date(p+j),t=new Date(0);return t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),t}return new Date(p+j+m)}let r={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},i=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,l=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,c=/^([+-])(\d{2})(?::?(\d{2}))?$/;function d(e){return e?parseInt(e):1}function o(e){return e&&parseFloat(e.replace(",","."))||0}let h=[31,null,31,30,31,30,31,31,30,31,30,31];function u(e){return e%400==0||e%4==0&&e%100!=0}},87374:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7138,5769,8884,1915,1490,587,7328,8965,1859,6874,6060,6764,8782,6723,7655,1309,6315,7875,1549,6466,8441,1684,7358],()=>t(35184)),_N_E=e.O()}]);