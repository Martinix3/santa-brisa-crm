"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8347],{30356:(e,a,s)=>{s.d(a,{C:()=>d,z:()=>i});var l=s(95155),n=s(12115),r=s(54059),t=s(70154),o=s(59434);let i=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,l.jsx)(r.bL,{className:(0,o.cn)("grid gap-2",s),...n,ref:a})});i.displayName=r.bL.displayName;let d=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,l.jsx)(r.q7,{ref:a,className:(0,o.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...n,children:(0,l.jsx)(r.C1,{className:"flex items-center justify-center",children:(0,l.jsx)(t.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});d.displayName=r.q7.displayName},71280:(e,a,s)=>{s.d(a,{A:()=>I});var l=s(95155),n=s(12115),r=s(90221),t=s(62177),o=s(68663),i=s(4028),d=s(30285),c=s(54165),u=s(17759),m=s(62523),x=s(88539),p=s(30356),h=s(85511),j=s(14636),f=s(59409),v=s(59434),g=s(73168),y=s(61055),b=s(51920),N=s(50172),C=s(87481),R=s(22346),A=s(93473);let w=o.Ik({outcome:o.k5(["successful","failed","follow-up"],{required_error:"Por favor, seleccione un resultado."}),notes:o.Yj().optional(),paymentMethod:o.Ie().optional(),numberOfUnits:o.au.number().positive("El n\xfamero de unidades debe ser un n\xfamero positivo.").optional(),unitPrice:o.au.number().positive("El precio unitario debe ser un n\xfamero positivo.").optional(),nextActionType:o.Ie().optional(),nextActionCustom:o.Yj().optional(),nextActionDate:o.p6().optional(),assignedSalesRepId:o.Yj().optional(),failureReasonType:o.Ie().optional(),failureReasonCustom:o.Yj().optional()}).superRefine((e,a)=>{"successful"===e.outcome&&(e.paymentMethod||a.addIssue({code:i.eq.custom,message:"La forma de pago es obligatoria.",path:["paymentMethod"]}),(void 0===e.numberOfUnits||e.numberOfUnits<=0)&&a.addIssue({code:i.eq.custom,message:"El n\xfamero de unidades es obligatorio.",path:["numberOfUnits"]}),(void 0===e.unitPrice||e.unitPrice<=0)&&a.addIssue({code:i.eq.custom,message:"El precio unitario es obligatorio.",path:["unitPrice"]})),"follow-up"===e.outcome&&(e.nextActionType||a.addIssue({code:i.eq.custom,message:"La pr\xf3xima acci\xf3n es obligatoria.",path:["nextActionType"]}),"Opci\xf3n personalizada"!==e.nextActionType||e.nextActionCustom&&""!==e.nextActionCustom.trim()||a.addIssue({code:i.eq.custom,message:"Debe especificar la pr\xf3xima acci\xf3n.",path:["nextActionCustom"]})),"failed"===e.outcome&&(e.failureReasonType||a.addIssue({code:i.eq.custom,message:"El motivo del fallo es obligatorio.",path:["failureReasonType"]}),"Otro (especificar)"!==e.failureReasonType||e.failureReasonCustom&&""!==e.failureReasonCustom.trim()||a.addIssue({code:i.eq.custom,message:"Debe especificar el motivo del fallo.",path:["failureReasonCustom"]}))});function I(e){let{order:a,isOpen:s,onOpenChange:o,onSave:i,allTeamMembers:I,currentUser:M,currentUserRole:P}=e,{toast:z}=(0,C.dj)(),[S,T]=n.useState(!1),E=(0,t.mN)({resolver:(0,r.u)(w),defaultValues:{outcome:void 0,notes:"",paymentMethod:"Adelantado",numberOfUnits:void 0,unitPrice:void 0,nextActionType:void 0,nextActionCustom:"",nextActionDate:void 0,assignedSalesRepId:null==M?void 0:M.id,failureReasonType:void 0,failureReasonCustom:""}});n.useEffect(()=>{a&&s&&E.reset({outcome:void 0,notes:"",paymentMethod:"Adelantado",numberOfUnits:void 0,unitPrice:void 0,nextActionType:void 0,nextActionCustom:"",nextActionDate:void 0,assignedSalesRepId:null==M?void 0:M.id,failureReasonType:void 0,failureReasonCustom:""})},[a,s,E,null==M?void 0:M.id]);let q=async e=>{a&&(T(!0),await i(e,a),T(!1))},J=E.watch("outcome"),O=E.watch("nextActionType"),k=E.watch("failureReasonType"),F=n.useMemo(()=>I.filter(e=>"SalesRep"===e.role||"Admin"===e.role),[I]);return(0,l.jsx)(c.lG,{open:s,onOpenChange:o,children:(0,l.jsxs)(c.Cf,{className:"sm:max-w-lg",children:[(0,l.jsxs)(c.c7,{children:[(0,l.jsxs)(c.L3,{children:["\xa1Tarea Completada! Registra el resultado para: ",null==a?void 0:a.clientName]}),(0,l.jsx)(c.rr,{children:"Indica el resultado de la interacci\xf3n y los pr\xf3ximos pasos. Se crear\xe1 un nuevo registro y la tarea actual se marcar\xe1 como completada."})]}),(0,l.jsx)(u.lV,{...E,children:(0,l.jsxs)("form",{onSubmit:E.handleSubmit(q),className:"space-y-6 py-2",children:[(0,l.jsx)(u.zB,{control:E.control,name:"outcome",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{className:"space-y-3",children:[(0,l.jsx)(u.lR,{children:"Resultado de la Interacci\xf3n"}),(0,l.jsx)(u.MJ,{children:(0,l.jsxs)(p.z,{onValueChange:a.onChange,value:a.value,className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,l.jsxs)(u.eI,{className:"flex items-center space-x-3 space-y-0 p-3 border rounded-md has-[:checked]:border-primary",children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(p.C,{value:"successful"})}),(0,l.jsx)(u.lR,{className:"font-normal",children:"Pedido Exitoso"})]}),(0,l.jsxs)(u.eI,{className:"flex items-center space-x-3 space-y-0 p-3 border rounded-md has-[:checked]:border-primary",children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(p.C,{value:"follow-up"})}),(0,l.jsx)(u.lR,{className:"font-normal",children:"Requiere Seguimiento"})]}),(0,l.jsxs)(u.eI,{className:"flex items-center space-x-3 space-y-0 p-3 border rounded-md has-[:checked]:border-primary col-span-full sm:col-span-1",children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(p.C,{value:"failed"})}),(0,l.jsx)(u.lR,{className:"font-normal",children:"Fallido / Sin Pedido"})]})]})}),(0,l.jsx)(u.C5,{})]})}}),"successful"===J&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R.w,{}),(0,l.jsx)("h4",{className:"text-md font-medium",children:"Detalles del Pedido Exitoso"}),(0,l.jsx)(u.zB,{control:E.control,name:"paymentMethod",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Forma de Pago"}),(0,l.jsxs)(f.l6,{onValueChange:a.onChange,value:a.value,children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(f.bq,{children:(0,l.jsx)(f.yv,{placeholder:"Seleccionar..."})})}),(0,l.jsx)(f.gC,{children:A.IJ.map(e=>(0,l.jsx)(f.eb,{value:e,children:e},e))})]}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)(u.zB,{control:E.control,name:"numberOfUnits",render:e=>{var a;let{field:s}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"N\xba Unidades"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{type:"number",placeholder:"Ej: 12",...s,value:null!=(a=s.value)?a:""})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:E.control,name:"unitPrice",render:e=>{var a;let{field:s}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Precio (â‚¬ sin IVA)"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{type:"number",step:"0.01",placeholder:"Ej: 15.5",...s,value:null!=(a=s.value)?a:""})}),(0,l.jsx)(u.C5,{})]})}})]})]}),"follow-up"===J&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R.w,{}),(0,l.jsx)("h4",{className:"text-md font-medium",children:"Pr\xf3xima Tarea de Seguimiento"}),(0,l.jsx)(u.zB,{control:E.control,name:"nextActionType",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Pr\xf3xima Acci\xf3n"}),(0,l.jsxs)(f.l6,{onValueChange:a.onChange,value:a.value,children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(f.bq,{children:(0,l.jsx)(f.yv,{placeholder:"Seleccionar..."})})}),(0,l.jsx)(f.gC,{children:A.Cv.map(e=>(0,l.jsx)(f.eb,{value:e,children:e},e))})]}),(0,l.jsx)(u.C5,{})]})}}),"Opci\xf3n personalizada"===O&&(0,l.jsx)(u.zB,{control:E.control,name:"nextActionCustom",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Especificar Pr\xf3xima Acci\xf3n"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{...a})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:E.control,name:"nextActionDate",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{className:"flex flex-col",children:[(0,l.jsx)(u.lR,{children:"Fecha Pr\xf3xima Acci\xf3n (Opcional)"}),(0,l.jsxs)(j.AM,{children:[(0,l.jsx)(j.Wv,{asChild:!0,children:(0,l.jsx)(u.MJ,{children:(0,l.jsxs)(d.$,{variant:"outline",className:(0,v.cn)("pl-3 text-left font-normal",!a.value&&"text-muted-foreground"),children:[a.value?(0,g.GP)(a.value,"PPP",{locale:y.es}):(0,l.jsx)("span",{children:"Seleccione fecha"}),(0,l.jsx)(b.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,l.jsx)(j.hl,{className:"w-auto p-0",children:(0,l.jsx)(h.V,{mode:"single",selected:a.value,onSelect:a.onChange,initialFocus:!0,locale:y.es})})]}),(0,l.jsx)(u.C5,{})]})}}),"Admin"===P?(0,l.jsx)(u.zB,{control:E.control,name:"assignedSalesRepId",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Asignar Seguimiento a:"}),(0,l.jsxs)(f.l6,{onValueChange:a.onChange,value:a.value,children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(f.bq,{children:(0,l.jsx)(f.yv,{placeholder:"Seleccionar responsable"})})}),(0,l.jsx)(f.gC,{children:F.map(e=>(0,l.jsx)(f.eb,{value:e.id,children:e.name},e.id))})]}),(0,l.jsx)(u.C5,{})]})}}):(0,l.jsxs)("div",{children:[(0,l.jsx)(u.lR,{children:"Asignado a:"}),(0,l.jsx)("p",{className:"text-sm font-medium mt-2",children:null==M?void 0:M.name})]})]}),"failed"===J&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R.w,{}),(0,l.jsx)("h4",{className:"text-md font-medium",children:"Detalles del Fallo"}),(0,l.jsx)(u.zB,{control:E.control,name:"failureReasonType",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Motivo del Fallo"}),(0,l.jsxs)(f.l6,{onValueChange:a.onChange,value:a.value,children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(f.bq,{children:(0,l.jsx)(f.yv,{placeholder:"Seleccionar..."})})}),(0,l.jsx)(f.gC,{children:A.HF.map(e=>(0,l.jsx)(f.eb,{value:e,children:e},e))})]}),(0,l.jsx)(u.C5,{})]})}}),"Otro (especificar)"===k&&(0,l.jsx)(u.zB,{control:E.control,name:"failureReasonCustom",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Especificar Motivo del Fallo"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{...a})}),(0,l.jsx)(u.C5,{})]})}})]}),(0,l.jsx)(R.w,{}),(0,l.jsx)(u.zB,{control:E.control,name:"notes",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Notas Adicionales (Opcional)"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(x.T,{placeholder:"A\xf1ada cualquier comentario sobre esta interacci\xf3n...",...a})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsxs)(c.Es,{className:"pt-4",children:[(0,l.jsx)(c.HM,{asChild:!0,children:(0,l.jsx)(d.$,{type:"button",variant:"outline",disabled:S,children:"Cancelar"})}),(0,l.jsx)(d.$,{type:"submit",disabled:S||!J,children:S?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardando..."]}):"Guardar Resultado"})]})]})})]})})}},90010:(e,a,s)=>{s.d(a,{$v:()=>j,EO:()=>m,Lt:()=>i,Rx:()=>f,Zr:()=>v,ck:()=>p,r7:()=>h,tv:()=>d,wd:()=>x});var l=s(95155),n=s(12115),r=s(17649),t=s(59434),o=s(30285);let i=r.bL,d=r.l9,c=r.ZL,u=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,l.jsx)(r.hJ,{className:(0,t.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n,ref:a})});u.displayName=r.hJ.displayName;let m=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,l.jsxs)(c,{children:[(0,l.jsx)(u,{}),(0,l.jsx)(r.UC,{ref:a,className:(0,t.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n})]})});m.displayName=r.UC.displayName;let x=e=>{let{className:a,...s}=e;return(0,l.jsx)("div",{className:(0,t.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...s})};x.displayName="AlertDialogHeader";let p=e=>{let{className:a,...s}=e;return(0,l.jsx)("div",{className:(0,t.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};p.displayName="AlertDialogFooter";let h=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,l.jsx)(r.hE,{ref:a,className:(0,t.cn)("text-lg font-semibold",s),...n})});h.displayName=r.hE.displayName;let j=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,l.jsx)(r.VY,{ref:a,className:(0,t.cn)("text-sm text-muted-foreground",s),...n})});j.displayName=r.VY.displayName;let f=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,l.jsx)(r.rc,{ref:a,className:(0,t.cn)((0,o.r)(),s),...n})});f.displayName=r.rc.displayName;let v=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,l.jsx)(r.ZD,{ref:a,className:(0,t.cn)((0,o.r)({variant:"outline"}),"mt-2 sm:mt-0",s),...n})});v.displayName=r.ZD.displayName}}]);