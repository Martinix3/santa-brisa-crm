"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3778],{14636:(e,r,t)=>{t.d(r,{AM:()=>o,Wv:()=>i,hl:()=>l});var a=t(95155),n=t(12115),s=t(20547),d=t(59434);let o=s.bL,i=s.l9,l=n.forwardRef((e,r)=>{let{className:t,align:n="center",sideOffset:o=4,...i}=e;return(0,a.jsx)(s.ZL,{children:(0,a.jsx)(s.UC,{ref:r,align:n,sideOffset:o,className:(0,d.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})})});l.displayName=s.UC.displayName},19564:(e,r,t)=>{t.d(r,{y:()=>n});var a=t(34477);let n=(0,a.createServerReference)("7f1e87e0573a6b4c8c91b413e52b517bc8f151c7f9",a.callServer,void 0,a.findSourceMapURL,"getInventoryItemsFS")},21141:(e,r,t)=>{t.d(r,{io:()=>i,Ck:()=>l});var a=t(95155),n=t(12115),s=t(34477);let d=(0,s.createServerReference)("7fee17d10823c0e61c4b4cf19391dbb8d88b0cb0d4",s.callServer,void 0,s.findSourceMapURL,"getCategoriesFS"),o=(0,n.createContext)({allCategories:[],isLoading:!0,categoriesMap:new Map,inventoryCategories:[],costCategories:[]});function i(e){let{children:r,dataSignature:t}=e,[s,i]=(0,n.useState)([]),[l,c]=(0,n.useState)(!0);(0,n.useEffect)(()=>{c(!0),d().then(i).catch(console.error).finally(()=>c(!1))},[t]);let u=(0,n.useMemo)(()=>{let e=new Map(s.map(e=>[e.id,e.name])),r=s.filter(e=>"inventory"===e.kind),t=s.filter(e=>"cost"===e.kind);return{allCategories:s,isLoading:l,categoriesMap:e,inventoryCategories:r,costCategories:t}},[s,l]);return(0,a.jsx)(o.Provider,{value:u,children:r})}function l(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useCategories must be used within a CategoriesProvider");return e}},31013:(e,r,t)=>{t.d(r,{U:()=>n});var a=t(34477);let n=(0,a.createServerReference)("7fd54d10ff98447e9902bf5724557cd460bc399d35",a.callServer,void 0,a.findSourceMapURL,"addInventoryItemFS")},47262:(e,r,t)=>{t.d(r,{S:()=>i});var a=t(95155),n=t(12115),s=t(76981),d=t(10518),o=t(59434);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(s.bL,{ref:r,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...n,children:(0,a.jsx)(s.C1,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})})});i.displayName=s.bL.displayName},61017:(e,r,t)=>{t.d(r,{A:()=>y});var a=t(95155),n=t(12115),s=t(90221),d=t(62177),o=t(68663),i=t(30285),l=t(54165),c=t(17759),u=t(62523),m=t(88539),x=t(59409),f=t(74601),h=t(50172),p=t(61930),j=t(21141),g=t(85057);let v=o.Ik({name:o.Yj().min(3,"El nombre del art\xedculo debe tener al menos 3 caracteres."),description:o.Yj().optional(),categoryId:o.Yj().min(1,"La categor\xeda es obligatoria."),uom:o.k5(["unit","kg","g","l","ml"]).optional(),safetyStock:o.au.number().min(0,"El stock de seguridad no puede ser negativo.").optional()});function b(e){var r;let{field:t,...n}=e,{ref:s,...d}=t;return(0,a.jsx)(u.p,{type:"number",ref:s,...d,...n,value:null!=(r=t.value)?r:"",onChange:e=>{let r=e.target.value;t.onChange(""===r?void 0:Number(r))}})}function y(e){let{item:r,itemBatches:t=[],isOpen:o,onOpenChange:y,onSave:C,isReadOnly:S=!1}=e,[k,N]=n.useState(!1),{inventoryCategories:I,isLoading:w}=(0,j.Ck)(),M=(0,d.mN)({resolver:(0,s.u)(v),defaultValues:{name:"",description:"",categoryId:void 0,uom:"unit",safetyStock:void 0}}),R=n.useMemo(()=>{if(!t||0===t.length)return 0;let e=t.reduce((e,r)=>e+r.qtyRemaining*r.unitCost,0),r=t.reduce((e,r)=>e+r.qtyRemaining,0);return r>0?e/r:0},[t]);n.useEffect(()=>{o&&(r?M.reset({name:r.name,description:r.description||"",categoryId:r.categoryId,uom:r.uom||"unit",safetyStock:r.safetyStock}):M.reset({name:"",description:"",categoryId:void 0,uom:"unit",safetyStock:void 0}))},[r,o,M]);let A=async e=>{S||(N(!0),await C(e,null==r?void 0:r.id),N(!1))};return(0,a.jsx)(l.lG,{open:o,onOpenChange:y,children:(0,a.jsxs)(l.Cf,{className:"sm:max-w-lg md:max-w-xl",children:[(0,a.jsxs)(l.c7,{children:[(0,a.jsx)(l.L3,{children:S?"Detalles del Art\xedculo de Inventario":r?"Editar Art\xedculo de Inventario":"A\xf1adir Nuevo Art\xedculo de Inventario"}),(0,a.jsx)(l.rr,{children:S?'Viendo detalles de "'.concat(null==r?void 0:r.name,'".'):r?"Modifica los detalles del art\xedculo.":"Introduce la informaci\xf3n del nuevo art\xedculo."})]}),(0,a.jsx)(c.lV,{...M,children:(0,a.jsxs)("form",{onSubmit:M.handleSubmit(A),className:"space-y-4 py-2",children:[(0,a.jsx)(c.zB,{control:M.control,name:"name",render:e=>{let{field:r}=e;return(0,a.jsxs)(c.eI,{children:[(0,a.jsx)(c.lR,{children:"Nombre del Art\xedculo"}),(0,a.jsx)(c.MJ,{children:(0,a.jsx)(u.p,{placeholder:"Ej: Cubitera Met\xe1lica Grande",...r,disabled:S})}),(0,a.jsx)(c.C5,{})]})}}),r&&r.sku&&(0,a.jsxs)("div",{children:[(0,a.jsx)(g.J,{children:"SKU (Autom\xe1tico)"}),(0,a.jsx)("p",{className:"font-mono text-sm text-muted-foreground p-2 border rounded-md bg-muted",children:r.sku})]}),!r&&(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(g.J,{children:"SKU"}),(0,a.jsxs)("div",{className:"flex h-10 w-full items-center rounded-md border border-input bg-muted px-3 py-2 text-sm text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4"}),"Se generar\xe1 autom\xe1ticamente al guardar"]})]}),r&&(0,a.jsxs)("div",{className:"p-3 bg-muted rounded-md border",children:[(0,a.jsx)(g.J,{children:"Coste Medio Ponderado (PMP)"}),(0,a.jsx)("p",{className:"font-semibold text-lg",children:(0,a.jsx)(p.A,{value:R,options:{style:"currency",currency:"EUR",minimumFractionDigits:4},placeholder:"Sin stock"})}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Calculado sobre el stock disponible en todos los lotes."})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,a.jsx)(c.zB,{control:M.control,name:"categoryId",render:e=>{let{field:r}=e;return(0,a.jsxs)(c.eI,{children:[(0,a.jsx)(c.lR,{children:"Categor\xeda de Inventario"}),(0,a.jsxs)(x.l6,{onValueChange:r.onChange,value:r.value,disabled:S||w,children:[(0,a.jsx)(c.MJ,{children:(0,a.jsx)(x.bq,{children:(0,a.jsx)(x.yv,{placeholder:w?"Cargando...":"Seleccione una categor\xeda"})})}),(0,a.jsx)(x.gC,{children:I.map(e=>(0,a.jsx)(x.eb,{value:e.id,children:e.name},e.id))})]}),(0,a.jsx)(c.C5,{})]})}})}),(0,a.jsx)(c.zB,{control:M.control,name:"description",render:e=>{let{field:r}=e;return(0,a.jsxs)(c.eI,{children:[(0,a.jsx)(c.lR,{children:"Descripci\xf3n (Opcional)"}),(0,a.jsx)(c.MJ,{children:(0,a.jsx)(m.T,{placeholder:"Breve descripci\xf3n del art\xedculo, caracter\xedsticas...",...r,disabled:S,className:"min-h-[80px]"})}),(0,a.jsx)(c.C5,{})]})}}),(0,a.jsx)(c.zB,{control:M.control,name:"safetyStock",render:e=>{let{field:r}=e;return(0,a.jsxs)(c.eI,{children:[(0,a.jsx)(c.lR,{children:"Stock M\xednimo de Seguridad"}),(0,a.jsx)(c.MJ,{children:(0,a.jsx)(b,{field:r,placeholder:"Ej: 100",disabled:S})}),(0,a.jsx)(c.Rr,{className:"text-xs",children:"Cuando el stock sea igual o inferior a este valor, se mostrar\xe1 una alerta visual."}),(0,a.jsx)(c.C5,{})]})}}),(0,a.jsxs)(l.Es,{className:"pt-6",children:[(0,a.jsx)(l.HM,{asChild:!0,children:(0,a.jsx)(i.$,{type:"button",variant:"outline",disabled:k&&!S,children:S?"Cerrar":"Cancelar"})}),!S&&(0,a.jsx)(i.$,{type:"submit",disabled:k||!M.formState.isDirty&&!!r,children:k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardando..."]}):r?"Guardar Cambios":"A\xf1adir Art\xedculo"})]})]})})]})})}}}]);