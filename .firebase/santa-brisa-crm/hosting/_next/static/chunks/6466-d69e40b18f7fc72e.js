"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6466],{1741:(e,a,s)=>{s.d(a,{$:()=>r});var l=s(34477);let r=(0,l.createServerReference)("7f825ebedb8d968a878774c6d2ff5db72d533b7458",l.callServer,void 0,l.findSourceMapURL,"deleteEventFS")},12372:(e,a,s)=>{s.d(a,{r:()=>r});var l=s(34477);let r=(0,l.createServerReference)("7f9691d0f9f547685d7820f71c8952cd5d14947e39",l.callServer,void 0,l.findSourceMapURL,"getEventsFS")},17972:(e,a,s)=>{s.d(a,{G7:()=>o,L$:()=>m,h_:()=>x,oI:()=>c,uB:()=>i,xL:()=>u});var l=s(95155),r=s(12115),n=s(77740),t=s(75074),d=s(59434);s(54165);let i=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,l.jsx)(n.uB,{ref:a,className:(0,d.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...r})});i.displayName=n.uB.displayName;let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,l.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,l.jsx)(t.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,l.jsx)(n.uB.Input,{ref:a,className:(0,d.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...r})]})});o.displayName=n.uB.Input.displayName;let c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,l.jsx)(n.uB.List,{ref:a,className:(0,d.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...r})});c.displayName=n.uB.List.displayName;let u=r.forwardRef((e,a)=>(0,l.jsx)(n.uB.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));u.displayName=n.uB.Empty.displayName;let m=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,l.jsx)(n.uB.Group,{ref:a,className:(0,d.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...r})});m.displayName=n.uB.Group.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,l.jsx)(n.uB.Separator,{ref:a,className:(0,d.cn)("-mx-1 h-px bg-border",s),...r})}).displayName=n.uB.Separator.displayName;let x=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,l.jsx)(n.uB.Item,{ref:a,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50",s),...r})});x.displayName=n.uB.Item.displayName},19564:(e,a,s)=>{s.d(a,{y:()=>r});var l=s(34477);let r=(0,l.createServerReference)("7f1e87e0573a6b4c8c91b413e52b517bc8f151c7f9",l.callServer,void 0,l.findSourceMapURL,"getInventoryItemsFS")},47262:(e,a,s)=>{s.d(a,{S:()=>i});var l=s(95155),r=s(12115),n=s(76981),t=s(10518),d=s(59434);let i=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,l.jsx)(n.bL,{ref:a,className:(0,d.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,l.jsx)(n.C1,{className:(0,d.cn)("flex items-center justify-center text-current"),children:(0,l.jsx)(t.A,{className:"h-4 w-4"})})})});i.displayName=n.bL.displayName},53359:(e,a,s)=>{s.d(a,{Z:()=>r});var l=s(34477);let r=(0,l.createServerReference)("7fbaec1241a25cbe3f98d83865238b06f91cf6992e",l.callServer,void 0,l.findSourceMapURL,"addEventFS")},54951:(e,a,s)=>{s.d(a,{T:()=>r});var l=s(34477);let r=(0,l.createServerReference)("7fcd80d77868106a651770bb1b8e6217d9c830cc53",l.callServer,void 0,l.findSourceMapURL,"updateEventFS")},60877:(e,a,s)=>{s.d(a,{V:()=>r});var l=s(34477);let r=(0,l.createServerReference)("7fb8f5b318f1812c9dde5d692f2ee445fc3047f479",l.callServer,void 0,l.findSourceMapURL,"getCostCentersFS")},66424:(e,a,s)=>{s.d(a,{F:()=>d});var l=s(95155),r=s(12115),n=s(47655),t=s(59434);let d=r.forwardRef((e,a)=>{let{className:s,children:r,...d}=e;return(0,l.jsxs)(n.bL,{ref:a,className:(0,t.cn)("relative overflow-hidden",s),...d,children:[(0,l.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,l.jsx)(i,{}),(0,l.jsx)(n.OK,{})]})});d.displayName=n.bL.displayName;let i=r.forwardRef((e,a)=>{let{className:s,orientation:r="vertical",...d}=e;return(0,l.jsx)(n.VM,{ref:a,orientation:r,className:(0,t.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...d,children:(0,l.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});i.displayName=n.VM.displayName},73221:(e,a,s)=>{s.d(a,{A:()=>Y});var l=s(95155),r=s(12115),n=s(90221),t=s(62177),d=s(68663),i=s(4028),o=s(30285),c=s(54165),u=s(17759),m=s(62523),x=s(88539),h=s(59409),j=s(85511),p=s(14636),v=s(47262),f=s(66424),g=s(93473),b=s(51920),N=s(83173),y=s(21887),C=s(10518),w=s(57082),I=s(87374),M=s(50172),R=s(77223),S=s(34301),E=s(22346),D=s(59434),B=s(44861),k=s(83343),A=s(73168),F=s(78816),L=s(82083),z=s(61055),V=s(61930),q=s(19564),P=s(60877),U=s(87481),J=s(17972);let T=d.Ik({materialId:d.Yj().min(1,"Debe seleccionar un material."),quantity:d.au.number().min(1,"La cantidad debe ser al menos 1.")}),_=d.Ik({name:d.Yj().min(3,"El nombre del evento debe tener al menos 3 caracteres."),type:d.k5(g.l,{required_error:"El tipo de evento es obligatorio."}),status:d.k5(g.Ly,{required_error:"El estado del evento es obligatorio."}),startDate:d.p6({required_error:"La fecha de inicio es obligatoria."}),endDate:d.p6().optional(),description:d.Yj().optional(),location:d.Yj().optional(),assignedTeamMemberIds:d.YO(d.Yj()).default([]),assignedMaterials:d.YO(T).optional().default([]),notes:d.Yj().optional(),budget:d.au.number().min(0,"El presupuesto debe ser un n\xfamero positivo.").optional(),currency:d.k5(["EUR","USD","MXN"]).optional(),isCashflowForecast:d.zM().default(!1),salesTarget:d.au.number().min(0,"El objetivo de ventas debe ser un n\xfamero positivo.").optional(),salesActual:d.au.number().min(0,"El resultado real debe ser un n\xfamero positivo.").optional(),costCenterId:d.Yj().optional(),accountId:d.Yj().optional(),accountName:d.Yj().optional()}).superRefine((e,a)=>{e.startDate&&e.endDate&&e.endDate<e.startDate&&a.addIssue({code:i.eq.custom,message:"La fecha de fin no puede ser anterior a la fecha de inicio.",path:["endDate"]})}),O="##NONE##";function Y(e){let{event:a,isOpen:s,onOpenChange:d,onSave:i,isReadOnly:T=!1,allTeamMembers:Y,allAccounts:$}=e,[G,H]=r.useState(!1),[W,K]=r.useState([]),[X,Z]=r.useState([]),[Q,ee]=r.useState(!1),[ea,es]=r.useState(""),{toast:el}=(0,U.dj)(),er=r.useMemo(()=>Y.filter(e=>"SalesRep"===e.role||"Admin"===e.role||"Clavadista"===e.role),[Y]),en=(0,t.mN)({resolver:(0,n.u)(_),defaultValues:{name:"",type:void 0,status:"Planificado",startDate:new Date,endDate:void 0,description:"",location:"",assignedTeamMemberIds:[],assignedMaterials:[],notes:"",budget:void 0,currency:"EUR",isCashflowForecast:!1,salesTarget:void 0,salesActual:void 0,costCenterId:"",accountId:"",accountName:""}}),{fields:et,append:ed,remove:ei}=(0,t.jz)({control:en.control,name:"assignedMaterials"}),eo=en.watch("assignedMaterials");r.useEffect(()=>{!async function(){if(s){ee(!0);try{let[e,a]=await Promise.all([(0,q.y)(),(0,P.V)()]);K(e),Z(a)}catch(e){console.error("Error loading dropdown data for event dialog:",e),el({title:"Error Datos",description:"No se pudieron cargar los datos para el di\xe1logo.",variant:"destructive"})}finally{ee(!1)}}}()},[s,el]);let ec=r.useMemo(()=>eo.reduce((e,a)=>{var s;let l=W.find(e=>e.id===a.materialId);return e+((null==l||null==(s=l.latestPurchase)?void 0:s.calculatedUnitCost)||0)*a.quantity},0),[eo,W]);r.useEffect(()=>{s&&(a?en.reset({name:a.name,type:a.type,status:a.status,startDate:a.startDate&&(0,B.f)((0,k.H)(a.startDate))?(0,k.H)(a.startDate):new Date,endDate:a.endDate&&(0,B.f)((0,k.H)(a.endDate))?(0,k.H)(a.endDate):void 0,description:a.description||"",location:a.location||"",assignedTeamMemberIds:a.assignedTeamMemberIds||[],assignedMaterials:a.assignedMaterials||[],notes:a.notes||"",budget:a.budget,currency:a.currency||"EUR",isCashflowForecast:a.isCashflowForecast||!1,salesTarget:a.salesTarget,salesActual:a.salesActual,costCenterId:a.costCenterId||"",accountId:a.accountId||"",accountName:a.accountName||""}):en.reset({name:"",type:void 0,status:"Planificado",startDate:new Date,endDate:void 0,description:"",location:"",assignedTeamMemberIds:[],assignedMaterials:[],notes:"",budget:void 0,currency:"EUR",isCashflowForecast:!1,salesTarget:void 0,salesActual:void 0,costCenterId:"",accountId:"",accountName:""}))},[a,s,en]);let eu=async e=>{if(!T){for(let a of e.assignedMaterials||[]){let e=W.find(e=>e.id===a.materialId);if(e&&e.stock<a.quantity)return void el({title:"Stock Insuficiente",description:'No hay suficiente stock para "'.concat(e.name,'". Disponible: ').concat(e.stock,", Solicitado: ").concat(a.quantity,"."),variant:"destructive"})}H(!0),await new Promise(e=>setTimeout(e,500)),i(e,null==a?void 0:a.id),H(!1)}},em=r.useMemo(()=>ea?$.filter(e=>e.nombre.toLowerCase().includes(ea.toLowerCase())):$,[ea,$]);return(0,l.jsx)(c.lG,{open:s,onOpenChange:d,children:(0,l.jsxs)(c.Cf,{className:"sm:max-w-lg md:max-w-xl lg:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,l.jsxs)(c.c7,{children:[(0,l.jsx)(c.L3,{children:T?"Detalles del Evento":a?"Editar Evento":"A\xf1adir Nuevo Evento"}),(0,l.jsx)(c.rr,{children:T?'Viendo detalles de "'.concat(null==a?void 0:a.name,'".'):a?"Modifica los detalles del evento.":"Introduce la informaci\xf3n del nuevo evento."})]}),(0,l.jsx)(u.lV,{...en,children:(0,l.jsxs)("form",{onSubmit:en.handleSubmit(eu),className:"space-y-4 py-2",children:[(0,l.jsx)(u.zB,{control:en.control,name:"name",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Nombre del Evento"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{placeholder:"Ej: Lanzamiento Nueva Cosecha",...a,disabled:T})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(u.zB,{control:en.control,name:"type",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Tipo de Evento"}),(0,l.jsxs)(h.l6,{onValueChange:a.onChange,value:a.value,disabled:T,children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:"Seleccione un tipo"})})}),(0,l.jsx)(h.gC,{children:g.l.map(e=>(0,l.jsx)(h.eb,{value:e,children:e},e))})]}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:en.control,name:"status",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Estado del Evento"}),(0,l.jsxs)(h.l6,{onValueChange:a.onChange,value:a.value,disabled:T,children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:"Seleccione un estado"})})}),(0,l.jsx)(h.gC,{children:g.Ly.map(e=>(0,l.jsx)(h.eb,{value:e,children:e},e))})]}),(0,l.jsx)(u.C5,{})]})}})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(u.zB,{control:en.control,name:"startDate",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{className:"flex flex-col",children:[(0,l.jsx)(u.lR,{children:"Fecha de Inicio"}),(0,l.jsxs)(p.AM,{children:[(0,l.jsx)(p.Wv,{asChild:!0,children:(0,l.jsx)(u.MJ,{children:(0,l.jsxs)(o.$,{variant:"outline",className:(0,D.cn)("pl-3 text-left font-normal",!a.value&&"text-muted-foreground"),disabled:T,children:[a.value?(0,A.GP)(a.value,"PPP",{locale:z.es}):(0,l.jsx)("span",{children:"Seleccione fecha"}),(0,l.jsx)(b.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,l.jsx)(p.hl,{className:"w-auto p-0",align:"start",children:(0,l.jsx)(j.V,{mode:"single",selected:a.value,onSelect:a.onChange,disabled:T||(e=>e<(0,F.e)(new Date,1)&&!(0,L.n)(e,(0,F.e)(new Date,1))),initialFocus:!0,locale:z.es})})]}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:en.control,name:"endDate",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{className:"flex flex-col",children:[(0,l.jsx)(u.lR,{children:"Fecha de Fin (Opcional)"}),(0,l.jsxs)(p.AM,{children:[(0,l.jsx)(p.Wv,{asChild:!0,children:(0,l.jsx)(u.MJ,{children:(0,l.jsxs)(o.$,{variant:"outline",className:(0,D.cn)("pl-3 text-left font-normal",!a.value&&"text-muted-foreground"),disabled:T,children:[a.value?(0,A.GP)(a.value,"PPP",{locale:z.es}):(0,l.jsx)("span",{children:"Seleccione fecha"}),(0,l.jsx)(b.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,l.jsx)(p.hl,{className:"w-auto p-0",align:"start",children:(0,l.jsx)(j.V,{mode:"single",selected:a.value,onSelect:a.onChange,disabled:T||(e=>e<(en.getValues("startDate")||(0,F.e)(new Date,1))||e<(0,F.e)(new Date,1)&&!(0,L.n)(e,(0,F.e)(new Date,1))),initialFocus:!0,locale:z.es})})]}),(0,l.jsx)(u.C5,{})]})}})]}),(0,l.jsx)(u.zB,{control:en.control,name:"location",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Ubicaci\xf3n (Opcional)"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{placeholder:"Ej: Hotel Palace, Madrid",...a,disabled:T})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:en.control,name:"accountId",render:e=>{var a;let{field:s}=e;return(0,l.jsxs)(u.eI,{className:"flex flex-col",children:[(0,l.jsxs)(u.lR,{className:"flex items-center",children:[(0,l.jsx)(N.A,{className:"mr-2 h-4 w-4 text-primary"}),"Vincular a Cuenta de Cliente (Opcional)"]}),(0,l.jsxs)(p.AM,{children:[(0,l.jsx)(p.Wv,{asChild:!0,children:(0,l.jsx)(u.MJ,{children:(0,l.jsxs)(o.$,{variant:"outline",role:"combobox",className:(0,D.cn)("w-full justify-between",!s.value&&"text-muted-foreground"),disabled:T,children:[s.value?null==(a=$.find(e=>e.id===s.value))?void 0:a.nombre:"Seleccionar cuenta...",(0,l.jsx)(y.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),(0,l.jsx)(p.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,l.jsxs)(J.uB,{children:[(0,l.jsx)(J.G7,{placeholder:"Buscar cuenta...",value:ea,onValueChange:es}),(0,l.jsx)(J.xL,{children:"No se encontraron cuentas."}),(0,l.jsx)(J.oI,{children:(0,l.jsxs)(J.L$,{children:[(0,l.jsx)(J.h_,{value:"##NONE##",onSelect:()=>{en.setValue("accountId",""),en.setValue("accountName","")},children:"Ninguna"}),em.map(e=>(0,l.jsxs)(J.h_,{value:e.id,onSelect:()=>{en.setValue("accountId",e.id),en.setValue("accountName",e.nombre)},children:[(0,l.jsx)(C.A,{className:(0,D.cn)("mr-2 h-4 w-4",e.id===s.value?"opacity-100":"opacity-0")}),e.nombre]},e.id))]})})]})})]}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:en.control,name:"description",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Descripci\xf3n (Opcional)"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(x.T,{placeholder:"Breve descripci\xf3n del evento...",...a,disabled:T,className:"min-h-[80px]"})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(E.w,{className:"my-4"}),(0,l.jsx)("h3",{className:"text-md font-medium text-muted-foreground",children:"Planificaci\xf3n Financiera y KPIs"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(u.zB,{control:en.control,name:"budget",render:e=>{var a;let{field:s}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Presupuesto Estimado (€)"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{type:"number",step:"0.01",placeholder:"Ej: 1500.00",...s,disabled:T,onChange:e=>s.onChange(""===e.target.value?void 0:parseFloat(e.target.value)),value:null!=(a=s.value)?a:""})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:en.control,name:"currency",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Divisa"}),(0,l.jsxs)(h.l6,{onValueChange:a.onChange,value:a.value,disabled:T,children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{})})}),(0,l.jsx)(h.gC,{children:["EUR","USD","MXN"].map(e=>(0,l.jsx)(h.eb,{value:e,children:e},e))})]}),(0,l.jsx)(u.C5,{})]})}})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(u.zB,{control:en.control,name:"salesTarget",render:e=>{var a;let{field:s}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Objetivo Ventas (€)"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{type:"number",step:"0.01",placeholder:"Ej: 5000",...s,disabled:T,onChange:e=>s.onChange(""===e.target.value?void 0:parseFloat(e.target.value)),value:null!=(a=s.value)?a:""})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:en.control,name:"salesActual",render:e=>{var a;let{field:s}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Resultado Ventas (€)"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{type:"number",step:"0.01",placeholder:"Dejar en blanco hasta finalizar",...s,disabled:T,onChange:e=>s.onChange(""===e.target.value?void 0:parseFloat(e.target.value)),value:null!=(a=s.value)?a:""})}),(0,l.jsx)(u.C5,{})]})}})]}),(0,l.jsx)(u.zB,{control:en.control,name:"isCashflowForecast",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{className:"flex flex-row items-center space-x-3 space-y-0 rounded-md border p-4 shadow-sm",children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(v.S,{checked:a.value,onCheckedChange:a.onChange,disabled:T})}),(0,l.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,l.jsx)(u.lR,{children:"Incluir en previsi\xf3n de Cash Flow"}),(0,l.jsx)(u.Rr,{children:"Marca esta casilla para que el presupuesto del evento se refleje como una salida de caja prevista."})]})]})}}),(0,l.jsx)(E.w,{className:"my-4"}),(0,l.jsx)("h3",{className:"text-md font-medium text-muted-foreground",children:"Recursos y Personal"}),(0,l.jsx)(u.zB,{control:en.control,name:"costCenterId",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsxs)(u.lR,{className:"flex items-center",children:[(0,l.jsx)(w.A,{className:"mr-2 h-4 w-4 text-primary"}),"Asignar a Centro de Coste (Opcional)"]}),(0,l.jsxs)(h.l6,{onValueChange:e=>a.onChange(e===O?"":e),value:a.value||O,disabled:T||Q,children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:Q?"Cargando...":"Seleccionar centro de coste..."})})}),(0,l.jsxs)(h.gC,{children:[(0,l.jsx)(h.eb,{value:O,children:"Sin Asignar"}),X.map(e=>(0,l.jsx)(h.eb,{value:e.id,children:e.name},e.id))]})]}),(0,l.jsx)(u.Rr,{className:"text-xs",children:"Vincula este evento a un centro de coste para el seguimiento financiero."}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:en.control,name:"assignedTeamMemberIds",render:e=>{let{field:s}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Responsables Asignados"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(f.F,{className:"h-32 w-full rounded-md border p-2",children:(0,l.jsxs)("div",{className:"space-y-1",children:[er.map(e=>{var r;return(0,l.jsxs)(u.eI,{className:"flex flex-row items-center space-x-3 space-y-0",children:[(0,l.jsx)(v.S,{checked:null==(r=s.value)?void 0:r.includes(e.id),onCheckedChange:a=>{let l=s.value||[];return a?s.onChange([...l,e.id]):s.onChange(l.filter(a=>a!==e.id))},disabled:T,id:"member-checkbox-".concat(e.id,"-").concat((null==a?void 0:a.id)||"new")}),(0,l.jsxs)(u.lR,{htmlFor:"member-checkbox-".concat(e.id,"-").concat((null==a?void 0:a.id)||"new"),className:"font-normal text-sm",children:[e.name," (","SalesRep"===e.role?"Rep. Ventas":e.role,")"]})]},e.id)}),0===er.length&&(0,l.jsx)("p",{className:"text-xs text-muted-foreground p-2",children:"No hay miembros del equipo disponibles para asignar."})]})})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)(u.lR,{className:"flex items-center",children:[(0,l.jsx)(I.A,{className:"mr-2 h-4 w-4 text-primary"})," Materiales Promocionales Asignados"]}),Q&&(0,l.jsx)(M.A,{className:"h-4 w-4 animate-spin"}),!Q&&et.map((e,a)=>{var s,r;let n=W.find(e=>{var s;return e.id===(null==(s=eo[a])?void 0:s.materialId)}),t=(null==n||null==(s=n.latestPurchase)?void 0:s.calculatedUnitCost)||0;return(0,l.jsxs)("div",{className:"flex items-end gap-2 p-3 border rounded-md bg-secondary/30",children:[(0,l.jsx)(u.zB,{control:en.control,name:"assignedMaterials.".concat(a,".materialId"),render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{className:"flex-grow",children:[(0,l.jsx)(u.lR,{className:"text-xs",children:"Material"}),(0,l.jsxs)(h.l6,{onValueChange:a.onChange,value:a.value,disabled:T||Q,children:[(0,l.jsx)(u.MJ,{children:(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:Q?"Cargando...":"Seleccionar material"})})}),(0,l.jsx)(h.gC,{children:W.map(e=>(0,l.jsxs)(h.eb,{value:e.id,children:[e.name," (Stock: ",e.stock,")"]},e.id))})]}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)(u.zB,{control:en.control,name:"assignedMaterials.".concat(a,".quantity"),render:e=>{var a;let{field:s}=e;return(0,l.jsxs)(u.eI,{className:"w-24",children:[(0,l.jsx)(u.lR,{className:"text-xs",children:"Cantidad"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(m.p,{type:"number",...s,disabled:T,onChange:e=>s.onChange(""===e.target.value?void 0:parseInt(e.target.value,10)),value:null!=(a=s.value)?a:""})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsx)("div",{className:"text-sm text-muted-foreground w-28 text-right whitespace-nowrap",children:(null==(r=eo[a])?void 0:r.quantity)>0?(0,l.jsx)(V.A,{value:t*eo[a].quantity,options:{style:"currency",currency:"EUR"}}):(0,l.jsx)(V.A,{value:0,options:{style:"currency",currency:"EUR"}})}),!T&&(0,l.jsx)(o.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>ei(a),className:"text-destructive hover:bg-destructive/10",children:(0,l.jsx)(R.A,{className:"h-4 w-4"})})]},e.id)}),!T&&(0,l.jsxs)(o.$,{type:"button",variant:"outline",size:"sm",onClick:()=>ed({materialId:"",quantity:1}),className:"mt-2",disabled:Q,children:[(0,l.jsx)(S.A,{className:"mr-2 h-4 w-4"})," A\xf1adir Material al Evento"]}),eo.length>0&&(0,l.jsxs)("div",{className:"text-right font-medium text-primary pt-2",children:["Coste Total Estimado Materiales: ",(0,l.jsx)(V.A,{value:ec,options:{style:"currency",currency:"EUR"}})]})]}),(0,l.jsx)(E.w,{className:"my-4"}),(0,l.jsx)(u.zB,{control:en.control,name:"notes",render:e=>{let{field:a}=e;return(0,l.jsxs)(u.eI,{children:[(0,l.jsx)(u.lR,{children:"Notas Internas (Opcional)"}),(0,l.jsx)(u.MJ,{children:(0,l.jsx)(x.T,{placeholder:"Cualquier informaci\xf3n relevante para el equipo...",...a,disabled:T,className:"min-h-[80px]"})}),(0,l.jsx)(u.C5,{})]})}}),(0,l.jsxs)(c.Es,{className:"pt-6",children:[(0,l.jsx)(c.HM,{asChild:!0,children:(0,l.jsx)(o.$,{type:"button",variant:"outline",disabled:G&&!T,children:T?"Cerrar":"Cancelar"})}),!T&&(0,l.jsx)(o.$,{type:"submit",disabled:G||Q||!en.formState.isDirty&&!!a,children:G?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(M.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardando..."]}):a?"Guardar Cambios":"A\xf1adir Evento"})]})]})})]})})}}}]);